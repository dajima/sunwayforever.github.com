<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Git</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Git"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2013-05-17T12:29+0800"/>
<meta name="author" content="sunway"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>    <link rel="stylesheet" type="text/css" href="stylesheet.css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Git</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Git</a>
<ul>
<li><a href="#sec-1-1">1.1 Git basis</a></li>
<li><a href="#sec-1-2">1.2 Command</a></li>
<li><a href="#sec-1-3">1.3 Best practice</a></li>
<li><a href="#sec-1-4">1.4 Files</a></li>
<li><a href="#sec-1-5">1.5 Extension</a></li>
<li><a href="#sec-1-6">1.6 Misc</a></li>
<li><a href="#sec-1-7">1.7 Gerrit</a></li>
<li><a href="#sec-1-8">1.8 Repo</a></li>
<li><a href="#sec-1-9">1.9 Refs</a></li>
<li><a href="#sec-1-10">1.10 Footnotes</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Git</h2>
<div class="outline-text-2" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Git basis</h3>
<div class="outline-text-3" id="text-1-1">

<ul>
<li>git 是一个基于 key-value 的文件系统
</li>
<li>git 的 value 主要是四种对象: commit, tree, tag, object
</li>
<li>git 的 key 是一个 40B 的 hash 值, 以及各种各样的与 hash 等价的 reference 名
</li>
<li>git 会将同一个文件存在三个地方: snapshot, staging area (index), working tree
</li>
</ul>


</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Command</h3>
<div class="outline-text-3" id="text-1-2">


</div>

<div id="outline-container-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> Porcelain</h4>
<div class="outline-text-4" id="text-1-2-1">


</div>

<div id="outline-container-1-2-1-1" class="outline-5">
<h5 id="sec-1-2-1-1"><span class="section-number-5">1.2.1.1</span> add</h5>
<div class="outline-text-5" id="text-1-2-1-1">

<p>将 working tree的内容复制到 staging area
</p><ul>
<li>git add .
</li>
<li>git add foo.java
</li>
</ul>

</div>

</div>

<div id="outline-container-1-2-1-2" class="outline-5">
<h5 id="sec-1-2-1-2"><span class="section-number-5">1.2.1.2</span> archive</h5>
<div class="outline-text-5" id="text-1-2-1-2">

<p>git archive HEAD &ndash;format=tar.gz &gt; archive.tar.gz
</p></div>

</div>

<div id="outline-container-1-2-1-3" class="outline-5">
<h5 id="sec-1-2-1-3"><span class="section-number-5">1.2.1.3</span> bisect</h5>
<div class="outline-text-5" id="text-1-2-1-3">

<p>binary search, 即使用二分查找的方法查找某个 bug 是由哪将提交引入的
</p></div>

</div>

<div id="outline-container-1-2-1-4" class="outline-5">
<h5 id="sec-1-2-1-4"><span class="section-number-5">1.2.1.4</span> blame</h5>
<div class="outline-text-5" id="text-1-2-1-4">

<p>显示一个文件的每一行的最近一次修改, 包括 commit 及 author
</p><ul>
<li>git blame foo.java      
</li>
</ul>

</div>

</div>

<div id="outline-container-1-2-1-5" class="outline-5">
<h5 id="sec-1-2-1-5"><span class="section-number-5">1.2.1.5</span> branch</h5>
<div class="outline-text-5" id="text-1-2-1-5">

<p>显示, 建立, 删除分支
</p><ul>
<li><code>git branch -d test_branch</code>
  删除本地的 test_branch 分支, 如果该分支有新的 commit 没有 merge 到其
  start-point, 则操作失败
</li>
<li><code>git branch -D test_branch</code>
  强制删除 test_branch 分支
</li>
<li><code>git branch test_branch</code>
  创建 test_branch
</li>
<li><code>git branch test_branch 5c505c15cf761</code>
  以 5c505c15cf761 为 start-point 创建新分支 test_branch (start-point 可以是任意
  有效的 commit, 如 commit hash, tag, branch name, &hellip;)
</li>
<li><code>git branch -r</code>
  显示远程分支
</li>
<li><code>git branch --set-upstream test_branch remote/test_branch</code>
  设置 test_branch 的 upstream 分支为 remote/test_branch, 这样在 test_branch 下
  push, pull, fetch 等不再需要指明 远程仓库及远程分支
</li>
</ul>

</div>

</div>

<div id="outline-container-1-2-1-6" class="outline-5">
<h5 id="sec-1-2-1-6"><span class="section-number-5">1.2.1.6</span> checkout</h5>
<div class="outline-text-5" id="text-1-2-1-6">

<p>checkout 一个 snapshot 到 working tree
</p><ul>
<li><code>git checkout android_2.3.5</code>

<p>
  切换到 android<sub>2</sub>.3.5分支, 即使用 android<sub>2</sub>.3.5 分支的 snapshot 覆盖 staging
  area 及 working tree. 由于这个操作会覆盖 staging area 及 working
  directory, 所以 git 要求这个操作前当前分支必须是 clean 的, 即没有 un-staged 和
  un-commit 的内容, 否则会提示操作失败.
</p>
</li>
<li><code>git checkout -b android_2.3.5_local remote/android_2.3.5</code>

<p>
  这个操作是 git branch android<sub>2</sub>.3.5<sub>local</sub> remote/android<sub>2</sub>.3.5 是一样的效果的.正
  常情况下, 由于 remote/android<sub>2</sub>.3.5 不是本地分支, 不加 -b 参数的 checkout 命令
  会使当前处于 detached head 状态, 即没有一个显式的引用指向当前 HEAD, 所以一旦
  checkout 后做了一些修改, 然后不小心又将 HEAD 指向其它地方(通过 reset 或
  branch, checkout 命令), 会导致我们难以回到之前的点, 之前的修改就可能会丢失. (通
  过后面提到的 reflog 实际上还是能回去的)
</p>
<p>
  checkout 还有第二个重要的用法: 
</p></li>
<li><code>git checkout -- working_file</code>

<p>
  这个命令是使用 staging area 中的 对应的file 覆盖 working tree, 例如对本地
  一个已经纳入 git 管理的文件做了修改的动作, 尚未 git add, 则这时修改还没有进入
  staging area, 使用这个命令就可以丢弃本地的修改. 后面有会提到 git reset 命令,
  和这个很容易混淆
</p></li>
</ul>


<p>
git checkout 命令容易与 git reset 混淆, 为了便于区分, 一般情况下, 可以认为: 
</p>
<ol>
<li><span style="text-decoration:underline;">git  checkout 操作的是 staging area 与 working tree</span>
</li>
<li><span style="text-decoration:underline;">git reset 操作的是 snapshot(或者叫 tree 对象) 与 staging area</span>
</li>
</ol>


</div>

</div>

<div id="outline-container-1-2-1-7" class="outline-5">
<h5 id="sec-1-2-1-7"><span class="section-number-5">1.2.1.7</span> cherry</h5>
<div class="outline-text-5" id="text-1-2-1-7">

<p>find commit not merged upstream
</p><ul>
<li><code>git cherry</code>
</li>
</ul>


<p>
类似于: 
<code>git log &lt;remote/branch&gt;...HEAD &amp;&amp; git log HEAD...&lt;remote/branch&gt;</code>
或者:
<code>git rev-list HEAD --not &lt;remote/branch&gt; &amp;&amp; git rev-list &lt;remote/branch&gt; --not HEAD</code>
</p></div>

</div>

<div id="outline-container-1-2-1-8" class="outline-5">
<h5 id="sec-1-2-1-8"><span class="section-number-5">1.2.1.8</span> cherry-pick</h5>
<div class="outline-text-5" id="text-1-2-1-8">

<p>刚某个分支上的某些 commit merge到另一个分支
</p><ul>
<li>git cherry-pick commit1 commit2 commit3

<p>  
  cherry-pick 实际上是使用 merge 进行工作的, 具体来说, 它的工作过程大约是:
</p><ol>
<li>checkout 出当前分支与 commit1 的 merge-base (即两个分支的交点) 作为 base
</li>
<li>在 base 上 apply commit1, 由于 commit1 本来就在 base 的上游
     (fast-forward), 所以这一步不会冲突
</li>
<li>把 base merge 到 当前分支 (这一步可能冲突)
</li>
</ol>

</li>
</ul>


<p>
所以, 不要认为 cherry-pick 可以简单的把一个 commit 搬到另一个分支, cherry-pick
使用 merge 会在另一个分支上生成新的 commit, 而且可能冲突, 还可能因为 merge 的原
因导致与原分支不同的结果, 最后一定要 double check 一下. 
</p></div>

</div>

<div id="outline-container-1-2-1-9" class="outline-5">
<h5 id="sec-1-2-1-9"><span class="section-number-5">1.2.1.9</span> clean</h5>
<div class="outline-text-5" id="text-1-2-1-9">

<p>git clean -df
</p></div>

</div>

<div id="outline-container-1-2-1-10" class="outline-5">
<h5 id="sec-1-2-1-10"><span class="section-number-5">1.2.1.10</span> commit</h5>
<div class="outline-text-5" id="text-1-2-1-10">

<p>git commit 会将 staging area 的内容打包生成 tree 对象, 然后生成 commit 对象的过
程.
</p><ul>
<li>git commit
  git commit 之前, 需要将 working tree 的修改通过 git add 添加到 staging
  area.

<p>  
  一旦 git commit, 一般情况下数据是很难丢失的, 除非你删除了 .git 目录 &hellip; , 或者执行
  了一些特定的操作..
</p></li>
</ul>


</div>

</div>

<div id="outline-container-1-2-1-11" class="outline-5">
<h5 id="sec-1-2-1-11"><span class="section-number-5">1.2.1.11</span> diff</h5>
<div class="outline-text-5" id="text-1-2-1-11">

<p>显示文件更改
</p><ul>
<li>git diff 
  显示 working-directory 与 staging area 的不同
</li>
<li>git diff &ndash;staged
  显示 staging area 与 snapshot 的不同
</li>
<li>git diff &ndash; path
  与前两个命令不同的是, 这个只显示对应于 path 的修改
</li>
<li>git diff commit
  显示 HEAD 与 commit 的不同
</li>
<li>git diff commit1..commit2
  显示 commit1 与 commit2 的不同
</li>
<li>git diff A&hellip;B
  与 git diff $(git-merge-base A B) B 相同, 即 显示 B相对于 A,B 的共同祖先的修改. 
</li>
</ul>

</div>

</div>

<div id="outline-container-1-2-1-12" class="outline-5">
<h5 id="sec-1-2-1-12"><span class="section-number-5">1.2.1.12</span> difftool</h5>
<div class="outline-text-5" id="text-1-2-1-12">

<p>add these to .gitconfig:
</p>


<pre class="example">[diff]
        tool = meld
</pre>

</div>

</div>

<div id="outline-container-1-2-1-13" class="outline-5">
<h5 id="sec-1-2-1-13"><span class="section-number-5">1.2.1.13</span> fetch</h5>
<div class="outline-text-5" id="text-1-2-1-13">

<p>获取远程仓库的更新, 并更新本地的远程分支
</p>
<p>
每次 fetch 后,  refs/remotes/REMOTE/.. 下的各个远程分支所指向的 commit 会被更新, 
远程更新的对象和其他一些 ref, 例如 lightweight tag 也会被下载到本地,
</p>
<p>
远程分支记录的只是上次 fetch 时远程仓库的状况, 所以不要以为通过查找远程分支可以
知道当前远程仓库的状况, 如果想的话, 先 fetch
</p>
<ul>
<li>git fetch
  若当前分支是远程分支的跟踪分支, 则会更新对应的远程分支.
</li>
<li>git fetch REMOTE
  更新 REMOTE 仓库中远程分支
</li>
<li>git fetch REMOTE &lt;ref-spec&gt;

<p>
  ref-spec 更进一步指明远程仓库中的分支与本地远程分支的对应关系, 例如:
  git fetch korg refs/heads/android2.3.5<sub>vlx</sub>:refs/remotes/korg/android2.3.5<sub>vlx</sub>
</p>
<p>  
  其中 : 之前的部分对应的是 korg 仓库上的绝对路径, 而 : 后面的部分对应的是本地
  .git 目录下的绝对路径. 
</p>
<p>
  通过 git fetch 将远程仓库更新到本地远程分支后, 就可以对远程分支进行 rebase,
  merge 等操作了, 远程分支其实类似于一个"只读"的分支.
</p></li>
</ul>

</div>

</div>

<div id="outline-container-1-2-1-14" class="outline-5">
<h5 id="sec-1-2-1-14"><span class="section-number-5">1.2.1.14</span> log</h5>
<div class="outline-text-5" id="text-1-2-1-14">

<ul>
<li>git log
</li>
<li>git log &ndash;since
</li>
<li>git log &ndash;author
</li>
<li>git log commit1&hellip;commit2
  显示存在于 commit2 对应的 branch 中, 但没有存在于 commit1 对应的 branch中的
  commit, 类似于:
  git log $(git merge-base commit1 commit2) commit2

<p>
  这个命令用来比较远程分支与本地分支的不同时比较有用.
</p></li>
</ul>

</div>

</div>

<div id="outline-container-1-2-1-15" class="outline-5">
<h5 id="sec-1-2-1-15"><span class="section-number-5">1.2.1.15</span> merge</h5>
<div class="outline-text-5" id="text-1-2-1-15">

<ul>
<li>git merge commit
  将 commit 与 HEAD merge,  之后 HEAD 指向新生成的 commit

<p>
  例如当前分支为 master:
</p></li>
</ul>




<pre class="example">      A---B---C topic
     /
D---E---F---G master
</pre>

<p>
  执行 git merge topic 后的结果为:
</p>



<pre class="example">      A---B---C topic
     /         \
D---E---F---G---H master
</pre>


<p>
  与 rebase 不同的是, merge 会生成一个新的 commit (上例中的H)
</p>
<p>
  merge 与 rebase 的选择:
</p><ol>
<li>rebase 可以有机会修改之前的 commit
</li>
<li>rebase 不会生成新的 commit
</li>
<li>rebase 会使 commit history 好看一些 &hellip;
</li>
<li>rebase 会丢失 merge 信息, 有时会给 review 带来困扰
</li>
<li>小规模合并用 rebase,  大规模时用 merge
</li>
<li>个人倾向于尽量用 rebase 而不是 merge&hellip;
</li>
</ol>


<p>
git merge 可以通过参数指定不同的 strategy, 例如 ours strategy 是指遇到冲突时总是
丢弃对方的修改.
</p>
</div>

</div>

<div id="outline-container-1-2-1-16" class="outline-5">
<h5 id="sec-1-2-1-16"><span class="section-number-5">1.2.1.16</span> mergetool</h5>
<div class="outline-text-5" id="text-1-2-1-16">

<p>add these to .gitconfig:
</p>


<pre class="example">[merge]
        tool = meld
</pre>

</div>

</div>

<div id="outline-container-1-2-1-17" class="outline-5">
<h5 id="sec-1-2-1-17"><span class="section-number-5">1.2.1.17</span> pull</h5>
<div class="outline-text-5" id="text-1-2-1-17">

<ul>
<li>git pull &lt;REMOTE&gt; &lt;ref-spec&gt;
</li>
</ul>

<p>git pull === git fetch ; git merge
</p>
<p>
推荐不要使用 git pull, 而用 git fetch; git merge 或 git rebase 代替, 因为这样可
以有机会在 merge 远程代码时先看一下有什么变化. 
</p></div>

</div>

<div id="outline-container-1-2-1-18" class="outline-5">
<h5 id="sec-1-2-1-18"><span class="section-number-5">1.2.1.18</span> push</h5>
<div class="outline-text-5" id="text-1-2-1-18">

<ul>
<li>git push &lt;REMOTE&gt; &lt;ref-spec&gt;

<p>  
  git push 必须保证本地分支与远程分支是 fast-forward 关系, 即 本地分支通过
  parent 上溯可以到达远程分支, 否则操作会失败. 如果通过指定 ref-spec 的 + 参数强
  制 non-fast-forward push, 可能会给远程仓库造成严重的后果. 
</p></li>
</ul>


</div>

</div>

<div id="outline-container-1-2-1-19" class="outline-5">
<h5 id="sec-1-2-1-19"><span class="section-number-5">1.2.1.19</span> rebase</h5>
<div class="outline-text-5" id="text-1-2-1-19">


<p>
设当前分支为 topic, 当前分支的状态为:
</p>



<pre class="example">      A---B---C topic
     /
D---E---F---G master
</pre>


<p>
git rebase master 后分支的状态为:
</p>



<pre class="example">              A'--B'--C' topic
             /
D---E---F---G master
</pre>


<p>
即 git rebase 的过程是:
</p><ol>
<li>先从当前分支找到位于 HEAD 与 $(git merge-base master topic) 之间的 commit: A, B,C
</li>
<li>将 topic reset 到 master, 然后依次 merge A, B, C
</li>
<li>merge 过程中会生成新的 commit: A', B', C'
</li>
</ol>


<p>
将 git rebase 过程中有冲突时, 可以使用:
</p><ul>
<li>解决冲突, 然后 git rebase &ndash;continue 来 merge 下一个 commit
</li>
<li>使用 git rebase &ndash;abort 全部放弃, 回到 rebase 前的状态
</li>
<li>使用 git rebase &ndash;skip 忽略当前 commit, 继续 merge 下一个 commit
</li>
</ul>


<p>
一般情况下不要把一个远程分支 rebase 到其他分支, 或者更一般的情况: 不要把一个与别
人共享的分支 rebase 到其他分支.
</p><ul>
<li id="sec-1-2-1-19-1">rebase onto<br/>



<pre class="src src-example">                         H---I---J topicB
                               /
                      E---F---G  topicA
                     /
        A---B---C---D  master

then the command (current branch is on topicB)

    git rebase --onto master topicA 

would result in:

                     H'--I'--J'  topicB
                    /
                    | E---F---G  topicA
                    |/
        A---B---C---D  master
</pre>

</li>
</ul>
</div>

</div>

<div id="outline-container-1-2-1-20" class="outline-5">
<h5 id="sec-1-2-1-20"><span class="section-number-5">1.2.1.20</span> reflog</h5>
<div class="outline-text-5" id="text-1-2-1-20">

<p>reflog 是对付 detached head, 错误的 reset 等情况的神器.
</p>
<p>
简单的说, reflog 就是 reference log, 它会记录 HEAD 指针的变化, 例如, 如果使用
git reset &ndash;hard commit 将 HEAD reset 后, reflog 会增加一条记录, 保存 reset 之间
的 HEAD, 我们可以通过 reflog 中的这条记录轻松的恢复到 reset 之前的状态.
</p>
<p>
注意: reflog 只会保存在本地. 
</p><ul>
<li id="sec-1-2-1-20-1">git log -g<br/>
</li>
</ul>
</div>

</div>

<div id="outline-container-1-2-1-21" class="outline-5">
<h5 id="sec-1-2-1-21"><span class="section-number-5">1.2.1.21</span> reset</h5>
<div class="outline-text-5" id="text-1-2-1-21">

<p>与 checkout 类似, reset 有两种格式: 加 path 与不加 path
</p><ol>
<li>不加 path
<ul>
<li>git reset &ndash;soft commit
     将当前分支的 HEAD 指向另一个 commit, 但是只更新 snaptshot (或 tree), 完全不
     修改 staging area 和 working tree
</li>
<li>git reset &ndash;mixed commit
     在前一个命令的基础上, 还会更新 staging area
</li>
<li>git reset &ndash;hard commit
     在前一个命令的基础上, 还会更新 working tree

<p>
     所以, soft &ndash;&gt; mixed &ndash;&gt; hard 更新的内容是由少变多, 危险程度也依次递增, 使
     用时应格外小心. 另外, 虽然通过 reflog 可以恢复到 reset 之前的状态, 但
     staging area 和 working tree 一旦丢失是无法恢复的.
</p></li>
</ul>

</li>
<li>使用 path 参数
<ul>
<li>git reset commit &ndash; path
     还记得 git checkout &ndash; path 么? 这个命令是使用 staging area 恢复 working
     directory

<p>     
     git reset commit &ndash; path 与它类似, 不过它是使用 snapshot 恢复 staging area
     &hellip;
</p>
<p>
     如果我们想使用 snapshot 直接恢复 working tree 呢? 
</p><ul>
<li>通过这两个命令配合
</li>
<li>或者使用 git checkout &ndash;patch tree-dish &ndash; path :)
</li>
</ul>

</li>
</ul>

</li>
</ol>

</div>

</div>

<div id="outline-container-1-2-1-22" class="outline-5">
<h5 id="sec-1-2-1-22"><span class="section-number-5">1.2.1.22</span> revert</h5>
<div class="outline-text-5" id="text-1-2-1-22">

<p>如果发现某次 commit 有严重的 side effect 想取消那次 commit 的话:
</p><ol>
<li>若 commit 只是在本地分支, 还没有 push 到远程, 而且该 commit 是 HEAD, 那我们可
   以简单的通过 git reset &ndash;hard HEAD~ 丢弃这个 commit
</li>
<li>若 commit 还没有 push 到远程, 但该 commit 不是 HEAD, 我们可以 reset 到
   commit~, 然后 cherry pick 该 commit 之上的所有 commit
</li>
<li>若 commit 已经 push 到远程, 那只有使用 revert 了
</li>
</ol>


<p>
git revert 大致的工作过程是:
</p><ol>
<li>git diff -R commit &gt; patch<sub>file</sub>
   生成 当前 HEAD 与 commit 的逆向 diff
</li>
<li>git apply patch<sub>file</sub>
</li>
</ol>


</div>

</div>

<div id="outline-container-1-2-1-23" class="outline-5">
<h5 id="sec-1-2-1-23"><span class="section-number-5">1.2.1.23</span> rm</h5>
<div class="outline-text-5" id="text-1-2-1-23">

<ul>
<li>直接使用 rm 命令
  rm file1 后, working tree 没有了 file1, 但 staging area 还存在, 所以这时要恢复
  该文件的话需要:
  <code>git checkout -- file1</code>
</li>
<li><code>git rm --cached file1</code>
  该命令直接从 staging area 中删除 file1, 所以要恢复的话:
<ul>
<li>使用 <code>git reset HEAD file1</code>, 从 snapshot 恢复 file1 到 staging area
</li>
<li>或 <code>git add file1</code>, 将同一个文件重新复制到 staging area
</li>
</ul>

</li>
<li><code>git rm</code>
  该命令同时删除 staging area 和 working tree 中的 file1, 要恢复的话:
<ul>
<li><code>git reset HEAD file1 &amp;&amp; git checkout -- file1</code>
</li>
</ul>

</li>
</ul>


</div>

</div>

<div id="outline-container-1-2-1-24" class="outline-5">
<h5 id="sec-1-2-1-24"><span class="section-number-5">1.2.1.24</span> show</h5>
<div class="outline-text-5" id="text-1-2-1-24">

<p>git show 实际上算一个 plumbing command, 但一般用户可以使用它来查看某次 commit 的
内容, 如 git show HEAD
</p></div>

</div>

<div id="outline-container-1-2-1-25" class="outline-5">
<h5 id="sec-1-2-1-25"><span class="section-number-5">1.2.1.25</span> stash</h5>
<div class="outline-text-5" id="text-1-2-1-25">

<p>git stash 的作用相当于多个 staging area. 
当我们正在某个 topic branch 中工作, 这时有个严重的 bug 需要立即切换到其他分支去
fix, 如果这时我们直接 git checkout branch2 切换到 branch2, 则 git 会自动将当前分
支上没有 commit 的修改 merge 到 branch2 &hellip;, 这肯定不是我们想要的, 所以我们需要:
</p><ol>
<li>将所有当前分支的修改 commit
</li>
<li>或者使用 stash

</li>
<li><code>git stash save &lt;message&gt;</code>
</li>
</ol>


<p>
将当前的更改保存到一个 stash 中, 并使用 message 来标识. 然后 git 会自动使用
<code>git reset --hard HEAD</code> 丢弃我们的更改. 
</p>
<ul>
<li><code>git stash list</code>
</li>
<li><code>git stash apply &lt;stash&gt;</code>
</li>
</ul>


</div>

</div>

<div id="outline-container-1-2-1-26" class="outline-5">
<h5 id="sec-1-2-1-26"><span class="section-number-5">1.2.1.26</span> status</h5>
<div class="outline-text-5" id="text-1-2-1-26">

<p>git status 显示的信息可能有:
</p><ul>
<li>your local branch is n commits ahead of the remote branch
  说明你该 push 了
</li>
<li>your local branch is n commits fall behind the remote ..
  说明你该 rebase 了
</li>
</ul>

</div>

</div>

<div id="outline-container-1-2-1-27" class="outline-5">
<h5 id="sec-1-2-1-27"><span class="section-number-5">1.2.1.27</span> submodule</h5>
<div class="outline-text-5" id="text-1-2-1-27">

</div>

</div>

<div id="outline-container-1-2-1-28" class="outline-5">
<h5 id="sec-1-2-1-28"><span class="section-number-5">1.2.1.28</span> tag</h5>
<div class="outline-text-5" id="text-1-2-1-28">

<p>tag 分为两种: light weight tag 和 annotated tag
</p><ul>
<li>light weight tag 只是 refs/tags/中的一些引用
</li>
<li>annotated tag 是真正的 git object, 会包含更多的信息, 如 message, signature &hellip;
</li>
</ul>

</div>
</div>

</div>

<div id="outline-container-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> Plumbing</h4>
<div class="outline-text-4" id="text-1-2-2">


</div>

<div id="outline-container-1-2-2-1" class="outline-5">
<h5 id="sec-1-2-2-1"><span class="section-number-5">1.2.2.1</span> cat-file</h5>
<div class="outline-text-5" id="text-1-2-2-1">

</div>

</div>

<div id="outline-container-1-2-2-2" class="outline-5">
<h5 id="sec-1-2-2-2"><span class="section-number-5">1.2.2.2</span> commit-tree</h5>
<div class="outline-text-5" id="text-1-2-2-2">

</div>

</div>

<div id="outline-container-1-2-2-3" class="outline-5">
<h5 id="sec-1-2-2-3"><span class="section-number-5">1.2.2.3</span> fsck</h5>
<div class="outline-text-5" id="text-1-2-2-3">

</div>

</div>

<div id="outline-container-1-2-2-4" class="outline-5">
<h5 id="sec-1-2-2-4"><span class="section-number-5">1.2.2.4</span> gc</h5>
<div class="outline-text-5" id="text-1-2-2-4">

</div>

</div>

<div id="outline-container-1-2-2-5" class="outline-5">
<h5 id="sec-1-2-2-5"><span class="section-number-5">1.2.2.5</span> hash-object</h5>
<div class="outline-text-5" id="text-1-2-2-5">

</div>

</div>

<div id="outline-container-1-2-2-6" class="outline-5">
<h5 id="sec-1-2-2-6"><span class="section-number-5">1.2.2.6</span> ls-remote</h5>
<div class="outline-text-5" id="text-1-2-2-6">

</div>

</div>

<div id="outline-container-1-2-2-7" class="outline-5">
<h5 id="sec-1-2-2-7"><span class="section-number-5">1.2.2.7</span> merge-base</h5>
<div class="outline-text-5" id="text-1-2-2-7">

</div>

</div>

<div id="outline-container-1-2-2-8" class="outline-5">
<h5 id="sec-1-2-2-8"><span class="section-number-5">1.2.2.8</span> receive-pack</h5>
<div class="outline-text-5" id="text-1-2-2-8">

</div>

</div>

<div id="outline-container-1-2-2-9" class="outline-5">
<h5 id="sec-1-2-2-9"><span class="section-number-5">1.2.2.9</span> rev-list</h5>
<div class="outline-text-5" id="text-1-2-2-9">

</div>

</div>

<div id="outline-container-1-2-2-10" class="outline-5">
<h5 id="sec-1-2-2-10"><span class="section-number-5">1.2.2.10</span> rev-parse</h5>
<div class="outline-text-5" id="text-1-2-2-10">

</div>

</div>

<div id="outline-container-1-2-2-11" class="outline-5">
<h5 id="sec-1-2-2-11"><span class="section-number-5">1.2.2.11</span> send-pack</h5>
<div class="outline-text-5" id="text-1-2-2-11">

</div>

</div>

<div id="outline-container-1-2-2-12" class="outline-5">
<h5 id="sec-1-2-2-12"><span class="section-number-5">1.2.2.12</span> symbolic-ref</h5>
<div class="outline-text-5" id="text-1-2-2-12">

</div>

</div>

<div id="outline-container-1-2-2-13" class="outline-5">
<h5 id="sec-1-2-2-13"><span class="section-number-5">1.2.2.13</span> update-index</h5>
<div class="outline-text-5" id="text-1-2-2-13">

</div>

</div>

<div id="outline-container-1-2-2-14" class="outline-5">
<h5 id="sec-1-2-2-14"><span class="section-number-5">1.2.2.14</span> update-ref</h5>
<div class="outline-text-5" id="text-1-2-2-14">

</div>

</div>

<div id="outline-container-1-2-2-15" class="outline-5">
<h5 id="sec-1-2-2-15"><span class="section-number-5">1.2.2.15</span> write-tree</h5>
<div class="outline-text-5" id="text-1-2-2-15">

</div>
</div>

</div>

<div id="outline-container-1-2-3" class="outline-4">
<h4 id="sec-1-2-3"><span class="section-number-4">1.2.3</span> refspec</h4>
<div class="outline-text-4" id="text-1-2-3">



</div>

<div id="outline-container-1-2-3-1" class="outline-5">
<h5 id="sec-1-2-3-1"><span class="section-number-5">1.2.3.1</span> fetch</h5>
<div class="outline-text-5" id="text-1-2-3-1">

<p>+refs/heads/*:refs/remotes/&lt;REMOTE&gt;/*
</p>
<p>
其中, `src` 是远程仓库 ref 的路径, `dst` 是本地的路径;
</p>
<p>
因为 fetch 是将远程仓库的 ref 更新到本地的 refs/remotes/&lt;REMOTE&gt; 下
</p></div>

</div>

<div id="outline-container-1-2-3-2" class="outline-5">
<h5 id="sec-1-2-3-2"><span class="section-number-5">1.2.3.2</span> push</h5>
<div class="outline-text-5" id="text-1-2-3-2">

<p>+refs/heads/*:refs/heads/*
</p>
<p>
其中, `src` 是本地 ref 的路径, `dst` 是远程仓库的路径
</p></div>
</div>
</div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Best practice</h3>
<div class="outline-text-3" id="text-1-3">

</div>

</div>

<div id="outline-container-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Files</h3>
<div class="outline-text-3" id="text-1-4">


</div>

<div id="outline-container-1-4-1" class="outline-4">
<h4 id="sec-1-4-1"><span class="section-number-4">1.4.1</span> config</h4>
<div class="outline-text-4" id="text-1-4-1">

</div>

</div>

<div id="outline-container-1-4-2" class="outline-4">
<h4 id="sec-1-4-2"><span class="section-number-4">1.4.2</span> HEAD</h4>
<div class="outline-text-4" id="text-1-4-2">

</div>

</div>

<div id="outline-container-1-4-3" class="outline-4">
<h4 id="sec-1-4-3"><span class="section-number-4">1.4.3</span> index</h4>
<div class="outline-text-4" id="text-1-4-3">

</div>

</div>

<div id="outline-container-1-4-4" class="outline-4">
<h4 id="sec-1-4-4"><span class="section-number-4">1.4.4</span> objects</h4>
<div class="outline-text-4" id="text-1-4-4">

</div>

</div>

<div id="outline-container-1-4-5" class="outline-4">
<h4 id="sec-1-4-5"><span class="section-number-4">1.4.5</span> refs</h4>
<div class="outline-text-4" id="text-1-4-5">


</div>

<div id="outline-container-1-4-5-1" class="outline-5">
<h5 id="sec-1-4-5-1"><span class="section-number-5">1.4.5.1</span> heads</h5>
<div class="outline-text-5" id="text-1-4-5-1">

</div>

</div>

<div id="outline-container-1-4-5-2" class="outline-5">
<h5 id="sec-1-4-5-2"><span class="section-number-5">1.4.5.2</span> remotes</h5>
<div class="outline-text-5" id="text-1-4-5-2">

</div>

</div>

<div id="outline-container-1-4-5-3" class="outline-5">
<h5 id="sec-1-4-5-3"><span class="section-number-5">1.4.5.3</span> tags</h5>
<div class="outline-text-5" id="text-1-4-5-3">

</div>
</div>
</div>

</div>

<div id="outline-container-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Extension</h3>
<div class="outline-text-3" id="text-1-5">


</div>

<div id="outline-container-1-5-1" class="outline-4">
<h4 id="sec-1-5-1"><span class="section-number-4">1.5.1</span> TopGit</h4>
<div class="outline-text-4" id="text-1-5-1">

</div>

</div>

<div id="outline-container-1-5-2" class="outline-4">
<h4 id="sec-1-5-2"><span class="section-number-4">1.5.2</span> StGit</h4>
<div class="outline-text-4" id="text-1-5-2">

</div>

</div>

<div id="outline-container-1-5-3" class="outline-4">
<h4 id="sec-1-5-3"><span class="section-number-4">1.5.3</span> WIP</h4>
<div class="outline-text-4" id="text-1-5-3">

</div>

</div>

<div id="outline-container-1-5-4" class="outline-4">
<h4 id="sec-1-5-4"><span class="section-number-4">1.5.4</span> git-svn</h4>
<div class="outline-text-4" id="text-1-5-4">

</div>
</div>

</div>

<div id="outline-container-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Misc</h3>
<div class="outline-text-3" id="text-1-6">


</div>

<div id="outline-container-1-6-1" class="outline-4">
<h4 id="sec-1-6-1"><span class="section-number-4">1.6.1</span> use GIT<sub>CURL</sub><sub>VERBOSE</sub> env to debug curl problem</h4>
<div class="outline-text-4" id="text-1-6-1">

</div>

</div>

<div id="outline-container-1-6-2" class="outline-4">
<h4 id="sec-1-6-2"><span class="section-number-4">1.6.2</span> config</h4>
<div class="outline-text-4" id="text-1-6-2">




<pre class="example">[color]
        ui = auto
[user]
        name = wei.sun
        email = wei.sun@spreadtrum.com
[http]
        postBuffer = 524288000
[commit]
        template = /home/apuser/.gitmessage
[giggle]
        main-window-maximized = true
        main-window-geometry = 700x550+0+25
        main-window-view = FileView
        history-view-vpane-position = 501
        file-view-vpane-position = 469
[alias]
        co = checkout
        ad = add
        ci = commit
        cp = cherry-pick
        st = status
        br = branch
        mt = mergetool
        dt = difftool 
        ps = push
        pl = pull
        cl = clean
        lg = log
[merge]
        tool = meld 
[diff]
        tool = meld
[difftool]
        prompt = No
[core]
      # ignore file mode change
        filemode = false 
</pre>

</div>
</div>

</div>

<div id="outline-container-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Gerrit</h3>
<div class="outline-text-3" id="text-1-7">

<p><a href="http://review.coreboot.org/Documentation/index.html">Gerrit Code Review for Git</a>
</p>
</div>

<div id="outline-container-1-7-1" class="outline-4">
<h4 id="sec-1-7-1"><span class="section-number-4">1.7.1</span> Hook</h4>
<div class="outline-text-4" id="text-1-7-1">

<p>.git/hooks/commit-msg
</p>
<p>
主要有两个功能:
</p><ul>
<li>verify_commit
</li>
<li>add<sub>changeid</sub>
  若 commit-msg 包含 Change-ID, 则使用这个 Change-ID, 否则,生成新的 change-id,
  并附加到 commit message 中.

<p>
  生成 change<sub>id</sub> 基本上是 head commit 去掉 commit message 后通过 hash<sub>object</sub> 生成的
  SHA-1, 所以 :
</p><ul>
<li>cherry-pick 生成的 commit 的 change<sub>id</sub> 是一样的
</li>
<li>但 merge 不行, 因为它会生成新的 commit
</li>
<li>commit &ndash;amend 生成的 commit 也是一样的, 因为在生成 change<sub>id</sub> 时,  commit
    message 不会考虑在内
</li>
</ul>

</li>
</ul>

</div>

</div>

<div id="outline-container-1-7-2" class="outline-4">
<h4 id="sec-1-7-2"><span class="section-number-4">1.7.2</span> Uploading changes</h4>
<div class="outline-text-4" id="text-1-7-2">

<p>当用户向 gerrit push 时, 不能直接向 refs/heads/xxx<sub>branch</sub> push, 而是需要向一个特
定的 refs/for/xxx<sub>branch</sub> push, 但 gerrit 在这个 refs 下并不创建任何 ref, 而是在
refs/changes/{nn}/{task}/{patch<sub>set</sub>} 下创建对应于该 commit 的 ref, 其中  task 是
根据 change<sub>id</sub> 生成的 task 号, nn 是 task 的最后两位数,  patch<sub>set</sub> 则是根据同一
个 change<sub>id</sub> 的多个 commit 自动递增的. 通过 git fetch gerrit<sub>url</sub>
refs/changes/{nn}/{task}/{patch<sub>set</sub>}, gerrit 评审者可以看到该 commit 的修改.
</p>
<p>
对同一个 task (或 change-id) 的多次 push, 会导致 gerrit 对同一个 task 生成多个
patch-set, 前提是:
</p><ol>
<li>要 push 的 各个 commit 的 parent 必须是相同的<sup><a class="footref" name="fnr-.1" href="#fn-.1">1</a></sup>
</li>
<li>有相同的 change-id 或 通过 git push gerrit<sub>url</sub> commit:refs/changes/{task<sub>id</sub>}
   形式 push 的并指定了相同的 task<sub>id</sub>
</li>
</ol>


</div>

<div id="outline-container-1-7-2-1" class="outline-5">
<h5 id="sec-1-7-2-1"><span class="section-number-5">1.7.2.1</span> gerrit receive-pack</h5>
<div class="outline-text-5" id="text-1-7-2-1">

<p>gerrit 重写了一个 git-receive-pack, 提供了几个和 gerrit 相关的参数, 如
&ndash;reviewer
</p>
</div>
</div>

</div>

<div id="outline-container-1-7-3" class="outline-4">
<h4 id="sec-1-7-3"><span class="section-number-4">1.7.3</span> Command line tools</h4>
<div class="outline-text-4" id="text-1-7-3">

</div>
</div>

</div>

<div id="outline-container-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> Repo</h3>
<div class="outline-text-3" id="text-1-8">


</div>

<div id="outline-container-1-8-1" class="outline-4">
<h4 id="sec-1-8-1"><span class="section-number-4">1.8.1</span> init</h4>
<div class="outline-text-4" id="text-1-8-1">

</div>

</div>

<div id="outline-container-1-8-2" class="outline-4">
<h4 id="sec-1-8-2"><span class="section-number-4">1.8.2</span> sync</h4>
<div class="outline-text-4" id="text-1-8-2">

</div>

</div>

<div id="outline-container-1-8-3" class="outline-4">
<h4 id="sec-1-8-3"><span class="section-number-4">1.8.3</span> for-all</h4>
<div class="outline-text-4" id="text-1-8-3">

</div>

</div>

<div id="outline-container-1-8-4" class="outline-4">
<h4 id="sec-1-8-4"><span class="section-number-4">1.8.4</span> upload</h4>
<div class="outline-text-4" id="text-1-8-4">

</div>

</div>

<div id="outline-container-1-8-5" class="outline-4">
<h4 id="sec-1-8-5"><span class="section-number-4">1.8.5</span> start</h4>
<div class="outline-text-4" id="text-1-8-5">

</div>

</div>

<div id="outline-container-1-8-6" class="outline-4">
<h4 id="sec-1-8-6"><span class="section-number-4">1.8.6</span> abandon</h4>
<div class="outline-text-4" id="text-1-8-6">

</div>
</div>

</div>

<div id="outline-container-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> Refs</h3>
<div class="outline-text-3" id="text-1-9">

<ul>
<li><a href="http://nvie.com/posts/a-successful-git-branching-model/">A Successful Git Branching Model</a>
</li>
</ul>

</div>

</div>

<div id="outline-container-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> Footnotes</h3>
<div class="outline-text-3" id="text-1-10">


<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">
<p class="footnote"><sup><a class="footnum" name="fn-.1" href="#fnr-.1">1</a></sup> 有待证实
</p>




</div>
</div>
</div>

</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2013-05-17T12:29+0800</p>
<p class="author">Author: sunway</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.1 with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 23</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
