<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Sqlite Api</title>
<!-- 2014-07-01 Tue 10:54 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Wei Sun (孙伟)" />
<link rel="stylesheet" type="text/css" href="/stylesheets/main.css" media="screen" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Sqlite Api</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Sqlite Api</a>
<ul>
<li><a href="#sec-1-1">1.1. sqlite3<sub>open</sub></a></li>
<li><a href="#sec-1-2">1.2. sqltie3<sub>prepare</sub><sub>v2</sub></a></li>
<li><a href="#sec-1-3">1.3. sqlite3<sub>step</sub></a></li>
<li><a href="#sec-1-4">1.4. sqlite3<sub>reset</sub></a></li>
<li><a href="#sec-1-5">1.5. sqlite3<sub>bind</sub></a></li>
<li><a href="#sec-1-6">1.6. sqlite3<sub>exec</sub></a></li>
<li><a href="#sec-1-7">1.7. sqlite3<sub>get</sub><sub>tables</sub></a></li>
<li><a href="#sec-1-8">1.8. sqlite3<sub>mprintf</sub></a></li>
<li><a href="#sec-1-9">1.9. sqlite3<sub>commit</sub><sub>hook</sub></a></li>
<li><a href="#sec-1-10">1.10. sqlite3<sub>rollback</sub><sub>hook</sub></a></li>
<li><a href="#sec-1-11">1.11. sqlite3<sub>busy</sub><sub>handler</sub></a></li>
<li><a href="#sec-1-12">1.12. sqlite3<sub>busy</sub><sub>timeout</sub></a></li>
<li><a href="#sec-1-13">1.13. sqlite3<sub>profile</sub></a></li>
<li><a href="#sec-1-14">1.14. sqlite3<sub>trace</sub></a></li>
<li><a href="#sec-1-15">1.15. sqlite3<sub>limit</sub></a></li>
<li><a href="#sec-1-16">1.16. sqlite3<sub>status</sub></a></li>
<li><a href="#sec-1-17">1.17. sqlite3<sub>db</sub><sub>status</sub></a></li>
<li><a href="#sec-1-18">1.18. sqlite3<sub>stmt</sub><sub>status</sub></a></li>
<li><a href="#sec-1-19">1.19. sqlite3<sub>config</sub></a></li>
<li><a href="#sec-1-20">1.20. sqlite3<sub>db</sub><sub>config</sub></a></li>
<li><a href="#sec-1-21">1.21. sqlite3<sub>memory</sub><sub>used</sub></a></li>
<li><a href="#sec-1-22">1.22. sqlite3<sub>memory</sub><sub>highwater</sub></a></li>
<li><a href="#sec-1-23">1.23. sqlite3<sub>last</sub><sub>insert</sub><sub>rowid</sub></a></li>
<li><a href="#sec-1-24">1.24. sqlite3<sub>set</sub><sub>authorizer</sub></a></li>
<li><a href="#sec-1-25">1.25. sqlite3<sub>changes</sub></a></li>
<li><a href="#sec-1-26">1.26. sqlite3<sub>get</sub><sub>tables</sub></a></li>
<li><a href="#sec-1-27">1.27. sqlite3<sub>commit</sub><sub>hook</sub></a></li>
<li><a href="#sec-1-28">1.28. sqlite3<sub>rollback</sub><sub>hook</sub></a></li>
<li><a href="#sec-1-29">1.29. sqlite3<sub>update</sub><sub>hook</sub></a></li>
<li><a href="#sec-1-30">1.30. sqlite3<sub>release</sub><sub>memory</sub></a></li>
<li><a href="#sec-1-31">1.31. sqlite3<sub>db</sub><sub>release</sub><sub>memory</sub></a></li>
<li><a href="#sec-1-32">1.32. sqlite3<sub>soft</sub><sub>heap</sub><sub>limit64</sub></a></li>
<li><a href="#sec-1-33">1.33. sqlite3<sub>table</sub><sub>column</sub><sub>metadata</sub></a></li>
<li><a href="#sec-1-34">1.34. blob 操作</a></li>
<li><a href="#sec-1-35">1.35. mutex</a></li>
<li><a href="#sec-1-36">1.36. wal</a></li>
<li><a href="#sec-1-37">1.37. sqlite3<sub>file</sub><sub>control</sub></a></li>
<li><a href="#sec-1-38">1.38. sqlite3<sub>finalize</sub></a></li>
<li><a href="#sec-1-39">1.39. extension api</a></li>
<li><a href="#sec-1-40">1.40. sample code</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Sqlite Api</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> sqlite3<sub>open</sub></h3>
</div>
<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> sqltie3<sub>prepare</sub><sub>v2</sub></h3>
</div>
<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> sqlite3<sub>step</sub></h3>
</div>
<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> sqlite3<sub>reset</sub></h3>
</div>
<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> sqlite3<sub>bind</sub></h3>
</div>
<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> sqlite3<sub>exec</sub></h3>
</div>
<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> sqlite3<sub>get</sub><sub>tables</sub></h3>
</div>
<div id="outline-container-sec-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> sqlite3<sub>mprintf</sub></h3>
</div>
<div id="outline-container-sec-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> sqlite3<sub>commit</sub><sub>hook</sub></h3>
</div>
<div id="outline-container-sec-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> sqlite3<sub>rollback</sub><sub>hook</sub></h3>
</div>
<div id="outline-container-sec-1-11" class="outline-3">
<h3 id="sec-1-11"><span class="section-number-3">1.11</span> sqlite3<sub>busy</sub><sub>handler</sub></h3>
</div>
<div id="outline-container-sec-1-12" class="outline-3">
<h3 id="sec-1-12"><span class="section-number-3">1.12</span> sqlite3<sub>busy</sub><sub>timeout</sub></h3>
</div>
<div id="outline-container-sec-1-13" class="outline-3">
<h3 id="sec-1-13"><span class="section-number-3">1.13</span> sqlite3<sub>profile</sub></h3>
</div>
<div id="outline-container-sec-1-14" class="outline-3">
<h3 id="sec-1-14"><span class="section-number-3">1.14</span> sqlite3<sub>trace</sub></h3>
</div>
<div id="outline-container-sec-1-15" class="outline-3">
<h3 id="sec-1-15"><span class="section-number-3">1.15</span> sqlite3<sub>limit</sub></h3>
</div>
<div id="outline-container-sec-1-16" class="outline-3">
<h3 id="sec-1-16"><span class="section-number-3">1.16</span> sqlite3<sub>status</sub></h3>
</div>
<div id="outline-container-sec-1-17" class="outline-3">
<h3 id="sec-1-17"><span class="section-number-3">1.17</span> sqlite3<sub>db</sub><sub>status</sub></h3>
</div>
<div id="outline-container-sec-1-18" class="outline-3">
<h3 id="sec-1-18"><span class="section-number-3">1.18</span> sqlite3<sub>stmt</sub><sub>status</sub></h3>
</div>
<div id="outline-container-sec-1-19" class="outline-3">
<h3 id="sec-1-19"><span class="section-number-3">1.19</span> sqlite3<sub>config</sub></h3>
</div>
<div id="outline-container-sec-1-20" class="outline-3">
<h3 id="sec-1-20"><span class="section-number-3">1.20</span> sqlite3<sub>db</sub><sub>config</sub></h3>
<div class="outline-text-3" id="text-1-20">
<ul class="org-ul">
<li>SQLITE<sub>DBCONFIG</sub><sub>LOOKASIDE</sub>
</li>
<li>SQLITE<sub>DBCONFIG</sub><sub>ENABLE</sub><sub>FKEY</sub>
</li>
<li>SQLITE<sub>DBCONFIG</sub><sub>ENABLE</sub><sub>TRIGGER</sub>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-21" class="outline-3">
<h3 id="sec-1-21"><span class="section-number-3">1.21</span> sqlite3<sub>memory</sub><sub>used</sub></h3>
</div>
<div id="outline-container-sec-1-22" class="outline-3">
<h3 id="sec-1-22"><span class="section-number-3">1.22</span> sqlite3<sub>memory</sub><sub>highwater</sub></h3>
</div>
<div id="outline-container-sec-1-23" class="outline-3">
<h3 id="sec-1-23"><span class="section-number-3">1.23</span> sqlite3<sub>last</sub><sub>insert</sub><sub>rowid</sub></h3>
</div>
<div id="outline-container-sec-1-24" class="outline-3">
<h3 id="sec-1-24"><span class="section-number-3">1.24</span> sqlite3<sub>set</sub><sub>authorizer</sub></h3>
</div>
<div id="outline-container-sec-1-25" class="outline-3">
<h3 id="sec-1-25"><span class="section-number-3">1.25</span> sqlite3<sub>changes</sub></h3>
</div>
<div id="outline-container-sec-1-26" class="outline-3">
<h3 id="sec-1-26"><span class="section-number-3">1.26</span> sqlite3<sub>get</sub><sub>tables</sub></h3>
</div>
<div id="outline-container-sec-1-27" class="outline-3">
<h3 id="sec-1-27"><span class="section-number-3">1.27</span> sqlite3<sub>commit</sub><sub>hook</sub></h3>
</div>
<div id="outline-container-sec-1-28" class="outline-3">
<h3 id="sec-1-28"><span class="section-number-3">1.28</span> sqlite3<sub>rollback</sub><sub>hook</sub></h3>
</div>
<div id="outline-container-sec-1-29" class="outline-3">
<h3 id="sec-1-29"><span class="section-number-3">1.29</span> sqlite3<sub>update</sub><sub>hook</sub></h3>
</div>
<div id="outline-container-sec-1-30" class="outline-3">
<h3 id="sec-1-30"><span class="section-number-3">1.30</span> sqlite3<sub>release</sub><sub>memory</sub></h3>
</div>
<div id="outline-container-sec-1-31" class="outline-3">
<h3 id="sec-1-31"><span class="section-number-3">1.31</span> sqlite3<sub>db</sub><sub>release</sub><sub>memory</sub></h3>
</div>
<div id="outline-container-sec-1-32" class="outline-3">
<h3 id="sec-1-32"><span class="section-number-3">1.32</span> sqlite3<sub>soft</sub><sub>heap</sub><sub>limit64</sub></h3>
</div>
<div id="outline-container-sec-1-33" class="outline-3">
<h3 id="sec-1-33"><span class="section-number-3">1.33</span> sqlite3<sub>table</sub><sub>column</sub><sub>metadata</sub></h3>
</div>
<div id="outline-container-sec-1-34" class="outline-3">
<h3 id="sec-1-34"><span class="section-number-3">1.34</span> blob 操作</h3>
<div class="outline-text-3" id="text-1-34">
</div><div id="outline-container-sec-1-34-1" class="outline-4">
<h4 id="sec-1-34-1"><span class="section-number-4">1.34.1</span> sqlite3<sub>blob</sub><sub>open</sub></h4>
</div>
<div id="outline-container-sec-1-34-2" class="outline-4">
<h4 id="sec-1-34-2"><span class="section-number-4">1.34.2</span> sqlite3<sub>blob</sub><sub>read</sub></h4>
</div>
<div id="outline-container-sec-1-34-3" class="outline-4">
<h4 id="sec-1-34-3"><span class="section-number-4">1.34.3</span> sqlite3<sub>blob</sub><sub>write</sub></h4>
</div>
</div>

<div id="outline-container-sec-1-35" class="outline-3">
<h3 id="sec-1-35"><span class="section-number-3">1.35</span> mutex</h3>
<div class="outline-text-3" id="text-1-35">
</div><div id="outline-container-sec-1-35-1" class="outline-4">
<h4 id="sec-1-35-1"><span class="section-number-4">1.35.1</span> sqlite3<sub>mutex</sub><sub>alloc</sub></h4>
</div>
<div id="outline-container-sec-1-35-2" class="outline-4">
<h4 id="sec-1-35-2"><span class="section-number-4">1.35.2</span> sqlite3<sub>mutex</sub><sub>enter</sub></h4>
</div>
<div id="outline-container-sec-1-35-3" class="outline-4">
<h4 id="sec-1-35-3"><span class="section-number-4">1.35.3</span> sqlite3<sub>mutex</sub><sub>free</sub></h4>
</div>
<div id="outline-container-sec-1-35-4" class="outline-4">
<h4 id="sec-1-35-4"><span class="section-number-4">1.35.4</span> sqlite3<sub>mutex</sub><sub>try</sub></h4>
</div>
<div id="outline-container-sec-1-35-5" class="outline-4">
<h4 id="sec-1-35-5"><span class="section-number-4">1.35.5</span> sqlite3<sub>mutex</sub><sub>leave</sub></h4>
</div>
</div>

<div id="outline-container-sec-1-36" class="outline-3">
<h3 id="sec-1-36"><span class="section-number-3">1.36</span> wal</h3>
<div class="outline-text-3" id="text-1-36">
</div><div id="outline-container-sec-1-36-1" class="outline-4">
<h4 id="sec-1-36-1"><span class="section-number-4">1.36.1</span> sqlite3<sub>wal</sub><sub>hook</sub></h4>
</div>
<div id="outline-container-sec-1-36-2" class="outline-4">
<h4 id="sec-1-36-2"><span class="section-number-4">1.36.2</span> sqlite3<sub>wal</sub><sub>autocheckpoint</sub></h4>
</div>
<div id="outline-container-sec-1-36-3" class="outline-4">
<h4 id="sec-1-36-3"><span class="section-number-4">1.36.3</span> sqlite3<sub>wal</sub><sub>checkpoint</sub><sub>v2</sub></h4>
<div class="outline-text-4" id="text-1-36-3">
<p>
<a href="http://sqlite.1065341.n5.nabble.com/Meaning-of-sqlite3-wal-checkpoint-v2-parameters-td30134.html">http://sqlite.1065341.n5.nabble.com/Meaning-of-sqlite3-wal-checkpoint-v2-parameters-td30134.html</a>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-37" class="outline-3">
<h3 id="sec-1-37"><span class="section-number-3">1.37</span> sqlite3<sub>file</sub><sub>control</sub></h3>
</div>
<div id="outline-container-sec-1-38" class="outline-3">
<h3 id="sec-1-38"><span class="section-number-3">1.38</span> sqlite3<sub>finalize</sub></h3>
<div class="outline-text-3" id="text-1-38">
<p>
在 auto-commit 模式下, sqlite3<sub>finalize</sub> 相当于 commit 的作用:
</p>
<ul class="org-ul">
<li>释放锁
</li>
<li>sync 日志与数据库
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-39" class="outline-3">
<h3 id="sec-1-39"><span class="section-number-3">1.39</span> extension api</h3>
<div class="outline-text-3" id="text-1-39">
</div><div id="outline-container-sec-1-39-1" class="outline-4">
<h4 id="sec-1-39-1"><span class="section-number-4">1.39.1</span> user defined functions</h4>
<div class="outline-text-4" id="text-1-39-1">
<p>
sqlite3<sub>create</sub><sub>funtion</sub>
</p>
</div>
</div>

<div id="outline-container-sec-1-39-2" class="outline-4">
<h4 id="sec-1-39-2"><span class="section-number-4">1.39.2</span> user defined aggregates</h4>
</div>
<div id="outline-container-sec-1-39-3" class="outline-4">
<h4 id="sec-1-39-3"><span class="section-number-4">1.39.3</span> user define collations</h4>
<div class="outline-text-4" id="text-1-39-3">
<p>
sqlite3<sub>create</sub><sub>collation</sub>
</p>
</div>
</div>
</div>

<div id="outline-container-sec-1-40" class="outline-3">
<h3 id="sec-1-40"><span class="section-number-3">1.40</span> sample code</h3>
<div class="outline-text-3" id="text-1-40">
<div class="org-src-container">

<pre class="src src-c"><span style="color: #cb4b16;">#include</span> <span style="color: #2aa198;">&lt;sqlite3.h&gt;</span>
<span style="color: #cb4b16;">#include</span> <span style="color: #2aa198;">&lt;pthread.h&gt;</span>

<span style="color: #b58900;">void</span> <span style="color: #268bd2;">query</span>(<span style="color: #b58900;">sqlite3</span> * <span style="color: #268bd2;">db</span>) {
    <span style="color: #b58900;">sqlite3_stmt</span> *<span style="color: #268bd2;">stmt</span>;
    <span style="color: #859900;">const</span> <span style="color: #b58900;">char</span> * <span style="color: #268bd2;">tail</span>;
    <span style="color: #b58900;">int</span> <span style="color: #268bd2;">rc</span>=sqlite3_prepare_v2(db,<span style="color: #2aa198;">"select * from test"</span>, -1, &amp;stmt, &amp;tail);
    <span style="color: #859900;">if</span> (rc!=SQLITE_OK) {
        fprintf(<span style="color: #2aa198;">"error prepare stmt: %s"</span>, sqlite3_errmsg(db));
        exit (1);
    }
    <span style="color: #b58900;">int</span> <span style="color: #268bd2;">count</span>=0;
    rc=sqlite3_step(stmt);
    <span style="color: #859900;">while</span> (rc==SQLITE_ROW) {
        count++;
        rc=sqlite3_step(stmt);
    }
    sqlite3_finalize(stmt);
    printf(<span style="color: #2aa198;">"query returns %d\n"</span>,count);
}

<span style="color: #b58900;">void</span> * <span style="color: #268bd2;">fun</span>(<span style="color: #b58900;">void</span> * <span style="color: #268bd2;">args</span>) {
    query((<span style="color: #b58900;">sqlite3</span> *)args);
}


<span style="color: #b58900;">int</span> <span style="color: #268bd2;">main</span>(<span style="color: #b58900;">int</span> <span style="color: #268bd2;">argc</span>, <span style="color: #b58900;">char</span> *<span style="color: #268bd2;">argv</span>[]) {
    sqlite3_config(SQLITE_CONFIG_SERIALIZED);
    <span style="color: #586e75; font-style: italic;">/* </span><span style="color: #586e75; font-style: italic;">sqlite3_enable_shared_cache(SQLITE_OPEN_SHAREDCACHE); </span><span style="color: #586e75; font-style: italic;">*/</span>
    <span style="color: #b58900;">sqlite3</span> *<span style="color: #268bd2;">db</span>;
    <span style="color: #b58900;">sqlite3</span> *<span style="color: #268bd2;">db2</span>;

    <span style="color: #b58900;">int</span> <span style="color: #268bd2;">rc</span>=sqlite3_open_v2(<span style="color: #2aa198;">"/home/sunway/test.db"</span>, &amp;db, SQLITE_OPEN_READWRITE, 0);

    <span style="color: #859900;">if</span> (rc) {
        printf(<span style="color: #2aa198;">"can't open db: %s"</span>,sqlite3_errmsg(db));
        sqlite3_close(db);
        exit(1);
    }

    <span style="color: #b58900;">pthread_t</span> <span style="color: #268bd2;">tid</span>;
    pthread_create(&amp;tid, <span style="color: #2aa198;">NULL</span>, fun, db);

    query(db);
    pthread_join(tid, <span style="color: #2aa198;">NULL</span>);
    <span style="color: #586e75; font-style: italic;">/* </span><span style="color: #586e75; font-style: italic;">char * sql="insert into test values (\"test\",1)"; </span><span style="color: #586e75; font-style: italic;">*/</span>
    <span style="color: #586e75; font-style: italic;">/* </span><span style="color: #586e75; font-style: italic;">char * zerr; </span><span style="color: #586e75; font-style: italic;">*/</span>
    <span style="color: #586e75; font-style: italic;">/* </span><span style="color: #586e75; font-style: italic;">rc=sqlite3_exec(db,sql,0,0,&amp;zerr); </span><span style="color: #586e75; font-style: italic;">*/</span>
    <span style="color: #586e75; font-style: italic;">/* </span><span style="color: #586e75; font-style: italic;">if (rc!=SQLITE_OK) { </span><span style="color: #586e75; font-style: italic;">*/</span>
    <span style="color: #586e75; font-style: italic;">/*  </span><span style="color: #586e75; font-style: italic;">printf("error when insert: %s", zerr); </span><span style="color: #586e75; font-style: italic;">*/</span>
    <span style="color: #586e75; font-style: italic;">/*  </span><span style="color: #586e75; font-style: italic;">exit (1); </span><span style="color: #586e75; font-style: italic;">*/</span>
    <span style="color: #586e75; font-style: italic;">/* </span><span style="color: #586e75; font-style: italic;">} </span><span style="color: #586e75; font-style: italic;">*/</span>
    <span style="color: #859900;">return</span> 0;
}
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Wei Sun (孙伟)</p>
<p class="email">Email: <a href="mailto:wei.sun@spreadtrum.com">wei.sun@spreadtrum.com</a></p>
<p class="date">Created: 2014-07-01 Tue 10:54</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.5g)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
