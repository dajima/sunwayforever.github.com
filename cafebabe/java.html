<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Jave</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Jave"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2013-05-17T12:23+0800"/>
<meta name="author" content="sunway"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012  Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Jave</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Java</a>
<ul>
<li><a href="#sec-1-1">1.1 Top topic</a></li>
<li><a href="#sec-1-2">1.2 misc</a></li>
<li><a href="#sec-1-3">1.3 Java Criticism</a></li>
<li><a href="#sec-1-4">1.4 Tools</a></li>
<li><a href="#sec-1-5">1.5 Java Language Specification (jls)</a></li>
<li><a href="#sec-1-6">1.6 Java Memory Area</a></li>
<li><a href="#sec-1-7">1.7 Concurrent</a></li>
<li><a href="#sec-1-8">1.8 HttpClient</a></li>
<li><a href="#sec-1-9">1.9 GC</a></li>
<li><a href="#sec-1-10">1.10 CG (code generation / 代码生成 )</a></li>
<li><a href="#sec-1-11">1.11 GP</a></li>
<li><a href="#sec-1-12">1.12 JDK Dynamic Proxy &amp; CGLIB</a></li>
<li><a href="#sec-1-13">1.13 JNI</a></li>
<li><a href="#sec-1-14">1.14 Reflection</a></li>
<li><a href="#sec-1-15">1.15 NIO</a></li>
<li><a href="#sec-1-16">1.16 Optimization</a></li>
<li><a href="#sec-1-17">1.17 Java Collection Framework</a></li>
<li><a href="#sec-1-18">1.18 Serialization</a></li>
<li><a href="#sec-1-19">1.19 UncaughtExceptionHandler</a></li>
<li><a href="#sec-1-20">1.20 JDWP</a></li>
<li><a href="#sec-1-21">1.21 Memory Model</a></li>
<li><a href="#sec-1-22">1.22 Java Module System</a></li>
<li><a href="#sec-1-23">1.23 ClassLoader</a></li>
<li><a href="#sec-1-24">1.24 CG (Code Generation)</a></li>
<li><a href="#sec-1-25">1.25 Security</a></li>
<li><a href="#sec-1-26">1.26 JVM based programming language</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Java</h2>
<div class="outline-text-2" id="text-1">


</div>

<div id="outline-container-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Top topic</h3>
<div class="outline-text-3" id="text-1-1">

<ul>
<li>Security
</li>
<li>Collection Framework
</li>
<li>Memory Model &amp; Concurrent
</li>
<li>NIO
</li>
<li>JVM
<ul>
<li>bytecode
</li>
<li>constant pool
</li>
<li>linking &amp; loading &amp; ClassLoader
</li>
</ul>

</li>
<li>JNI
</li>
<li>GP
</li>
<li>GC
</li>
<li>Reflect
</li>
<li>Module System
</li>
</ul>

</div>

</div>

<div id="outline-container-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> misc</h3>
<div class="outline-text-3" id="text-1-2">


</div>

<div id="outline-container-1-2-1" class="outline-4">
<h4 id="sec-1-2-1"><span class="section-number-4">1.2.1</span> <span class="done DONE">DONE</span> java initialization</h4>
<div class="outline-text-4" id="text-1-2-1">

<p>     <span class="timestamp-wrapper"><span class="timestamp-kwd">CLOSED: </span> <span class="timestamp">2011-08-02 Tue 15:28</span></span><br/>
</p><ul>
<li>State "DONE"       from "TODO" <span class="timestamp-wrapper"> <span class="timestamp">2011-08-02 Tue 15:28</span></span>
</li>
</ul>

<p>    java code:
</p>


<pre class="example">class S {
    static {
        System.out.println ("super static block");
    }
}

class Test extends S {
    static {
        System.out.println ("Test static block");
    }
    int x=1;
    public Test () {
        System.out.println ("Test ctor");
        foo ();
    }
    public static void main(String args[]) {
        Test t=new Test ();
    }
    void foo () {

    }
}
</pre>

<p>
    byte code of Test.class
</p>


<pre class="example">public Test();
  Code:
   Stack=2, Locals=1, Args_size=1
   0:   aload_0                                                // put the first argument (this) to operand stack
   1:   invokespecial   #1; //Method S."&lt;init&gt;":()V;           // call super.&lt;init&gt;
   4:   aload_0
   5:   iconst_1
   6:   putfield        #2; //Field x:I                        // initialize x=1
   9:   getstatic       #3; //Field java/lang/System.out:Ljava/io/PrintStream;  // The actual ctor: Test()
   12:  ldc     #4; //String Test ctor
   14:  invokevirtual   #5; //Method java/io/PrintStream.println:(Ljava/lang/String;)V
   17:  aload_0
   18:  invokevirtual   #6; //Method foo:()V
   21:  return
static {};
  Code:
   Stack=2, Locals=0, Args_size=0
   0:   getstatic       #3; //Field java/lang/System.out:Ljava/io/PrintStream;
   3:   ldc     #9; //String Test static block
   5:   invokevirtual   #5; //Method java/io/PrintStream.println:(Ljava/lang/String;)V
   8:   return
</pre>

<p>
    To summarize:
</p><ul>
<li>&lt;init&gt; differs with ctor!
      &lt;init&gt; will:
<ol>
<li>invoke super.&lt;init&gt;
</li>
<li>init member field
</li>
<li>call ctor
</li>
</ol>

</li>
</ul>


</div>

</div>

<div id="outline-container-1-2-2" class="outline-4">
<h4 id="sec-1-2-2"><span class="section-number-4">1.2.2</span> CharSequence vs. String</h4>
<div class="outline-text-4" id="text-1-2-2">

</div>

</div>

<div id="outline-container-1-2-3" class="outline-4">
<h4 id="sec-1-2-3"><span class="section-number-4">1.2.3</span> java de-initialization</h4>
<div class="outline-text-4" id="text-1-2-3">

</div>

</div>

<div id="outline-container-1-2-4" class="outline-4">
<h4 id="sec-1-2-4"><span class="section-number-4">1.2.4</span> final keyword</h4>
<div class="outline-text-4" id="text-1-2-4">

</div>

</div>

<div id="outline-container-1-2-5" class="outline-4">
<h4 id="sec-1-2-5"><span class="section-number-4">1.2.5</span> ConcurrentModificationException</h4>
<div class="outline-text-4" id="text-1-2-5">

</div>

</div>

<div id="outline-container-1-2-6" class="outline-4">
<h4 id="sec-1-2-6"><span class="section-number-4">1.2.6</span> <span class="done DONE">DONE</span> fail-fast iterator</h4>
<div class="outline-text-4" id="text-1-2-6">

<p>     <span class="timestamp-wrapper"><span class="timestamp-kwd">CLOSED: </span> <span class="timestamp">2011-07-26 Tue 16:16</span></span><br/>
</p><ul>
<li>State "DONE"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2011-07-26 Tue 16:16</span></span>
</li>
</ul>

<p>    see also <a href="#sec-1-2-5">ConcurrentModificationException</a>
    see also <a href="#sec-1-17-1">Immutable Collection</a>
</p>
<p>
    An iterator is considered <i>fail-fast</i> if it throws a <i>ConcurrentModificationException</i> under either the following two conditions:
</p><ol>
<li>In multithreaded processing: if one thread is trying to modify a <i>Collection</i> while anther one is iterating over it.
</li>
<li>In single-threaded: if after the creating of the <i>iterator</i>, the container is modified at any time by any method other than the iterator's own
       remove or add methods

</li>
<li>code snippet that will throw ConcurrentModificationException:
</li>
</ol>




<pre class="example">for (Foo o:container) {
  if (o.v==0) {
    container.remove(o);
  }
}
</pre>

<ul>
<li>using fail-fast iterator to avoid ConcurrentModificationException:
</li>
</ul>




<pre class="example">ListIterator ite=container.listIterator();
while (ite.hasNext()) {
  Foo o=ite.next();
  if (o.v==0) {
    ite.remove();
  }
}
</pre>

<ul>
<li>using a copy of container to avoid ConcurrentModificationException: see also <a href="#sec-1-17-1">Immutable Collection</a>
</li>
</ul>




<pre class="example">List tmp=new ArrayList(container);
for (Foo o:tmp) {
  if (o.v==0) {
    container.remove(o); // this works because of `shallow copy`
  }
}
</pre>

</div>

</div>

<div id="outline-container-initialization" class="outline-4">
<h4 id="initialization"><a name="sec-1-2-7" id="sec-1-2-7"></a><span class="section-number-4">1.2.7</span> initialization on-demand holder</h4>
<div class="outline-text-4" id="text-initialization">




<pre class="example">// Correct lazy initialization in Java
    @ThreadSafe
    class Foo {
      private static class HelperHolder {
        public static Helper helper = new Helper();
      }
      public static Helper getHelper() {
        return HelperHolder.helper;
      }
    }
</pre>

</div>

</div>

<div id="outline-container-1-2-8" class="outline-4">
<h4 id="sec-1-2-8"><span class="section-number-4">1.2.8</span> <span class="done DONE">DONE</span> java主线程与子线程的关系</h4>
<div class="outline-text-4" id="text-1-2-8">

<p>     <span class="timestamp-wrapper"><span class="timestamp-kwd">SCHEDULED: </span> <span class="timestamp">2011-02-09 Wed</span></span>  <span class="timestamp-wrapper"><span class="timestamp-kwd">CLOSED: </span> <span class="timestamp">2011-02-09 Wed 17:42</span></span><br/>
</p><ul>
<li>State "DONE" <span class="timestamp-wrapper"> <span class="timestamp">2011-02-09 Wed 17:42</span></span>
</li>
</ul>

<p>    java 主线程退出后,子线程仍成执行
    linux 主线程退出后,子线程也在执行
</p></div>

</div>

<div id="outline-container-1-2-9" class="outline-4">
<h4 id="sec-1-2-9"><span class="section-number-4">1.2.9</span> Java Service Wrapper</h4>
<div class="outline-text-4" id="text-1-2-9">

</div>

</div>

<div id="outline-container-1-2-10" class="outline-4">
<h4 id="sec-1-2-10"><span class="section-number-4">1.2.10</span> DOING StringBuffer vs. StringBuilder &nbsp;&nbsp;&nbsp;<span class="tag"><span class="java">java</span>&nbsp;<span class="string">string</span></span></h4>
<div class="outline-text-4" id="text-1-2-10">


</div>
</div>

</div>

<div id="outline-container-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Java Criticism</h3>
<div class="outline-text-3" id="text-1-3">

<p>   see also <a href="#sec-1-17-1">Immutable Collection</a>
   see also <a href="#sec-1-11">GP</a>
   see also <a href="#sec-1-9">GC</a>
</p>
<ul>
<li>enumeration
</li>
<li>final
</li>
</ul>

</div>

</div>

<div id="outline-container-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Tools</h3>
<div class="outline-text-3" id="text-1-4">

<ul>
<li>jps
</li>
<li>jmap
</li>
<li>jhat
</li>
<li>jstack
</li>
<li>jinfo
</li>
<li>MAT
</li>
<li>gcviewer
</li>
<li>visualvm
</li>
<li>keytool
</li>
<li>jarsigner
     <a href="http://download.oracle.com/javase/1.3/docs/tooldocs/win32/jarsigner.html">http://download.oracle.com/javase/1.3/docs/tooldocs/win32/jarsigner.html</a>
</li>
<li>javac
</li>
<li>javah
</li>
<li>javap -verbose 查看 bytecode
</li>
<li>java
     可能需要 fastdebug 版本才能使用下列某些命令
<ul>
<li>java -Xcomp -XX:+PrintAssembly -XX:CompileCommand='compileonly A.foo' -XX:CompileCommand='compileonly Test.main' -XX:CompileCommand='compileonly B.foo
</li>
<li>java -Xint
</li>
<li>java -Xss4096k Test  // set stack size
</li>
<li>java -Xms 4096k -Xmx 128m Test // set heap size
</li>
<li>java -verbose:sizes
</li>
<li>java -verbose:gc
</li>
<li>java -XX:+DisableExplicitGC
</li>
<li>java -client
</li>
<li>java -server
</li>
</ul>

</li>
</ul>

</div>

</div>

<div id="outline-container-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Java Language Specification (jls)</h3>
<div class="outline-text-3" id="text-1-5">

<ul>
<li>State "CANCELED"   from "DOING" <span class="timestamp-wrapper"> <span class="timestamp">2011-08-29 Mon 17:20</span></span>
</li>
</ul>


</div>

<div id="outline-container-1-5-1" class="outline-4">
<h4 id="sec-1-5-1"><span class="section-number-4">1.5.1</span> String</h4>
<div class="outline-text-4" id="text-1-5-1">


</div>

<div id="outline-container-1-5-1-1" class="outline-5">
<h5 id="sec-1-5-1-1"><span class="section-number-5">1.5.1.1</span> compile-time constant pool</h5>
<div class="outline-text-5" id="text-1-5-1-1">

<p>     all reference to the same compile-time String literal constant refers to the same String object in the <b>compile-time constant pool</b>
     e.g.
</p><ul>
<li>
<p>
       String s1="abc";
       String s2="abc";
       s1==s2 is true
</p></li>
<li>
<p>
       String s1=foo();
       String s2="abc";
       String foo() {return "abc";}
       s1==s2 is true;
</p></li>
</ul>

</div>

</div>

<div id="outline-container-1-5-1-2" class="outline-5">
<h5 id="sec-1-5-1-2"><span class="section-number-5">1.5.1.2</span> A.intern()</h5>
<div class="outline-text-5" id="text-1-5-1-2">

<p>     `constant pool` is stored in the .class file (like string literals in c/c++, which are statically stored at TEXT section)
     compile-time String are always `interned` to shared the same String instance in the constant pool.
     if the constant pool already contains a String whose value equals to A, return it, else, create a new String object in the pool, then return it.
     i.e. intern() may add a new entry to the constant pool!
</p><ul>
<li>intern() usage?
       suppose u are manage thousands of Strings whose value is
       among only 3 alternatives , u can make use of s.intern() instead of s, so
       as to store only 3 objects in the constant pool.
</li>
</ul>

</div>

</div>

<div id="outline-container-1-5-1-3" class="outline-5">
<h5 id="sec-1-5-1-3"><span class="section-number-5">1.5.1.3</span> concatenation operator `+`</h5>
<div class="outline-text-5" id="text-1-5-1-3">

<p>     The String concatenation operator `+` will only create new String object when operand are not <b>compile-time</b> constant.
     e.g.:
</p><ul>
<li>String s1="abc"
</li>
<li>String s2="abc"+"abc";
       will not create new String object at run-time, since "abc" are compile-time constant.
</li>
<li>final String s1="abc"; String s2=s1+"abc";
       also will not create new String object for s2, since s1 is a compile-time constant.
</li>
<li>final String s1=getString() or final String s1=new String("abc"); String s2=s1+"abc";
       will create new String object for s2, since s1 is not a compile-time constant (it's a run-time constant)
</li>
</ul>


</div>
</div>

</div>

<div id="outline-container-1-5-2" class="outline-4">
<h4 id="sec-1-5-2"><span class="section-number-4">1.5.2</span> conversion</h4>
<div class="outline-text-4" id="text-1-5-2">


</div>

<div id="outline-container-1-5-2-1" class="outline-5">
<h5 id="sec-1-5-2-1"><span class="section-number-5">1.5.2.1</span> Boolean</h5>
<div class="outline-text-5" id="text-1-5-2-1">

<p>     conversion between boolean and numeric is impossible.
</p></div>

</div>

<div id="outline-container-1-5-2-2" class="outline-5">
<h5 id="sec-1-5-2-2"><span class="section-number-5">1.5.2.2</span> Numeric</h5>
<div class="outline-text-5" id="text-1-5-2-2">

<ul>
<li>conversion between numeric primitive type can always be applied, implicitly or explicitly.
       e.g.
<ol>
<li>long l=2L;
         int a=(int)l;
</li>
<li>void foo(int);
         long x=2L;
         foo((int)x)
</li>
<li>int i=2;
          long l=i;
</li>
</ol>

<p>       Note:
       in example 1 &amp; 2, if the conversion will cause loss of precision, e.g. from long to int, explicitly conversion is mandatory.
       in example 3, implicitly conversion is applied, since the conversion cause no loss of precision.
</p></li>
<li>conversion between numeric primitive type's reference type is not allowed in anyway.
       e.g.
       Longer l=2L;
       Integer a=(Integer)l; is not allowed.
</li>
<li>conversion between numeric primitive and reference type is allowed, with auto boxing and un-boxing conversion
       e.g.
<ol>
<li>Integer a=1;
          long xx=a; // a is firstly un-boxed to int
</li>
<li>int aa=1;
          Long xx=(long)aa; // aa is firstly converted to long, then boxed to Long.
</li>
</ol>

</li>
</ul>


</div>

</div>

<div id="outline-container-1-5-2-3" class="outline-5">
<h5 id="sec-1-5-2-3"><span class="section-number-5">1.5.2.3</span> autoboxing &amp; un-boxing conversion</h5>
<div class="outline-text-5" id="text-1-5-2-3">

<p>     see also <a href="#constant-pool">constant pool</a>
     see also valueOf
</p><ul>
<li>un-boxing from one NULL object  will result in a NullPointerException, e.g. int a=getInt(); Integer getInt() {return null;}
</li>
<li>primitive type's reference type's ++/&ndash; will cause another reference class object be created
       e.g. Integer a=1; a++; then another Integer for value 2 is created automatically. (but may re-use an existing Integer(2) directly instead of
       create a new one)
</li>
<li>autoboxing 实际是只是隐式的调用了 valueOf
</li>
</ul>


</div>

</div>

<div id="outline-container-1-5-2-4" class="outline-5">
<h5 id="sec-1-5-2-4"><span class="section-number-5">1.5.2.4</span> valueOf</h5>
<div class="outline-text-5" id="text-1-5-2-4">




<pre class="example">Integer.valueOf():
  return  i &gt;= 128 || i &lt; -128 ? new Integer(i) : SMALL_VALUES[i + 128];
static {
  for(int i = -128; i &lt; 128; i++) {
    SMALL_VALUES[i + 128] = new Integer(i);
  }
}
</pre>


</div>

</div>

<div id="outline-container-1-5-2-5" class="outline-5">
<h5 id="sec-1-5-2-5"><span class="section-number-5">1.5.2.5</span> shift</h5>
<div class="outline-text-5" id="text-1-5-2-5">

<p>     before shifting char,byte,short, the operand will be converted to int through Numeric Conversion.
     e.g.
</p>


<pre class="example">byte b=0xff;
b=b&lt;&lt;8&gt;&gt;&gt;8;
first: b in converted to 0xff ff ff ff
second:&lt;&lt;8 result in 0xff ff ff 00
last :&gt;&gt;&gt;8 result in 0x00 ff ff ff
so lastly, b=0xff, instead of 0x00
</pre>

</div>
</div>

</div>

<div id="outline-container-1-5-3" class="outline-4">
<h4 id="sec-1-5-3"><span class="section-number-4">1.5.3</span> equals, hashCode, HashMap, ==</h4>
<div class="outline-text-4" id="text-1-5-3">

<ul>
<li>HashMap.contains(key)的大致做法:
      if (this==key || (this.hashCode()==key.hashCode() &amp;&amp; this.equals(key)):
        return true;
      else:
        return false;
</li>
<li>equals的实现
<ul>
<li>Object.equals(o):
        return this==o;
</li>
<li>Integer.equals(o):
        return this.value==o.value;
</li>
<li>String.equals(o):
        if this==o:
          return true;
        if this.hashCode()!=o.hashCode():
          return false;
        foreach byte:
          if byte1!=byte2:
            return false;
</li>
</ul>

</li>
<li>hashCode 的实现
<ul>
<li>Object.hashCode():
        返回内存地址
</li>
<li>Integer.hashCode():
        return this.value;
</li>
<li>String.hashCode():
        built upon this.value[]
</li>
</ul>

</li>
</ul>


</div>

</div>

<div id="outline-container-1-5-4" class="outline-4">
<h4 id="sec-1-5-4"><span class="section-number-4">1.5.4</span> Object.clone, shadow copy &amp; deep copy</h4>
<div class="outline-text-4" id="text-1-5-4">

<p>    In java, though clone is intent to produce a copy of the same object
    it is not guaranteed. Clone comes with lots of its and buts. So my first advice
    is to not depend on clones. If you want to provide a handle / method to deliver
    a copy of the current instance write a kind of factory method and provide it
    with a good documentation. When you are in a situation to use a third party
    component and produce copies of it using the clone method, then investigate that
    implementation carefully and get to know what is underlying. Because when you
    ask for a rabbit, it may give monkeys!
</p>
<ul>
<li>Shallow Copy

<p>
      Generally clone method of an object, creates a new instance of the same
      class and copies all the fields to the new instance and returns it. This
      is nothing but shallow copy. Object class provides a clone method and
      provides support for the shallow copy. It returns ¡®Object¡¯ as type and
      you need to explicitly cast back to your original object.
</p>
<p>
      Since the Object class has the clone method (protected) you cannot use it
      in all your classes. The class which you want to be cloned should
      implement clone method and overwrite it. It should provide its own meaning
      for copy or to the least it should invoke the super.clone(). Also you have
      to implement Cloneable marker interface or else you will get
      CloneNotSupportedException. When you invoke the super.clone() then you are
      dependent on the Object class¡¯s implementation and what you get is a
      shallow copy.
</p>
</li>
<li>Deep Copy

<p>
      When you need a deep copy then you need to implement it yourself. When the
      copied object contains some other object its references are copied
      recursively in deep copy. When you implement deep copy be careful as you
      might fall for cyclic dependencies. If you don¡¯t want to implement deep
      copy yourselves then you can go for serialization. It does implements deep
      copy implicitly and gracefully handling cyclic dependencies.
</p>
<p>
      One more disadvantage with this clone system is that, most of the
      interface / abstract class writers in java forget to put a public clone
      method. For example you can take List. So when you want to clone their
      implementations you have to ignore the abstract type and use actual
      implementations like ArrayList by name. This completely removes the
      advantage and goodness of abstractness.
</p>
<p>
      When implementing a singleton pattern, if its superclass implements a
      public clone() method, to prevent your subclass from using this class¡¯s
      clone() method to obtain a copy overwrite it and throw a
      CloneNotSupportedException.
</p>
<p>
      Note that clone is not for instantiation and initialization. It should not
      be synonymously used as creating a new object. Because the constructor of
      the cloned objects may never get invoked in the process. It is about
      copying the object in discussion and not creating new. It completely
      depends on the clone implementation. One more disadvantage (what to do
      there are so many), clone prevents the use of final fields. We have to
      find roundabout ways to copy the final fields into the copied object.
</p>
<p>
      Clone is an agreement between you, compiler and implementer. If you are
      confident that you all three have good knowledge of java, then go ahead
      and use clone. If you have a slightest of doubt better copy the object
      manually.
</p>
<p>
      Example source code for java clone and shallow copy
</p></li>
</ul>





<pre class="example">class Employee implements Cloneable {
private String name;
private String designation;
public Employee() {
  this.setDesignation("Programmer");
}
public Object clone() throws CloneNotSupportedException {
  /*
  Employee copyObj = new Employee();
  copyObj.setDesignation(this.designation);
  copyObj.setName(this.name);
  return copyObj;
  */
  return super.clone(); // called Object.clone()
  }
}
</pre>

<ul>
<li>Object.clone()
      Object.clone() is quite efficient, since it relies on JNI and use a bit-wise copy to clone the Object
</li>
</ul>


<p>
    To summarize:
</p><ul>
<li>clone is mainly used to produce a shadow copy of object
<ul>
<li>if u prefer deep copy, you can either use serialization, or use `
        ret=super.clone(); ret.obj1=this.obj1.clone();&hellip;.`, things like
        that. but circular references should be well concerned
</li>
</ul>

</li>
<li>super(Object).clone() is quite efficient, u need not rewrite clone() for simple Object
</li>
<li><b>many Abstract containers is not clone-able&hellip;e.g. List, but ArrayList is clone-able</b>
</li>
</ul>

</div>

</div>

<div id="outline-container-1-5-5" class="outline-4">
<h4 id="sec-1-5-5"><span class="section-number-4">1.5.5</span> constant variable</h4>
<div class="outline-text-4" id="text-1-5-5">

<p>    we call a variable, of primitives type or of String type, that is final and initialized with a compile-time expression a constant variable
    e.g. final int a=10; final String s="abc";
</p></div>

</div>

<div id="outline-container-1-5-6" class="outline-4">
<h4 id="sec-1-5-6"><span class="section-number-4">1.5.6</span> Throwable, Exception,Error</h4>
<div class="outline-text-4" id="text-1-5-6">

<p>    Note: all Exception and Error can be caught at run-time, even divided-by-zero error&hellip;
</p>


<pre class="example">Throwable
  Exception
    RuntimeException                    ;; unchecked exceptions
      NullPointerException
    ..                                  ;; checked exceptions, which can be declared in *Throws* clause
  Error
    OutOfMemoryError
    ..
</pre>


</div>

<div id="outline-container-1-5-6-1" class="outline-5">
<h5 id="sec-1-5-6-1"><span class="section-number-5">1.5.6.1</span> Throwable.fillInStackTrace()</h5>
<div class="outline-text-5" id="text-1-5-6-1">

</div>
</div>

</div>

<div id="outline-container-1-5-7" class="outline-4">
<h4 id="sec-1-5-7"><span class="section-number-4">1.5.7</span> <span class="done DONE">DONE</span> java inner class can't have static member? &nbsp;&nbsp;&nbsp;<span class="tag"><span class="coding">coding</span></span></h4>
<div class="outline-text-4" id="text-1-5-7">

<p> <span class="timestamp-wrapper"><span class="timestamp-kwd">CLOSED: </span> <span class="timestamp">2012-09-03 Mon 17:33</span></span>  <span class="timestamp-wrapper"><span class="timestamp-kwd">SCHEDULED: </span> <span class="timestamp">2012-09-03 Mon</span></span><br/>
because java inner class is always associated with an outer class instance, thus
it can't define static members or methods. 
</p></div>
</div>

</div>

<div id="outline-container-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Java Memory Area</h3>
<div class="outline-text-3" id="text-1-6">

<ul>
<li>Java Heap
     set by -Xms and -Xmx
</li>
<li>Java Stack
     set by -Xss
</li>
<li>Direct Buffer (ByteBuffer)
<ul>
<li>ByteBuffer.allocateDirect() actually will use mmap to map a separate VMA
</li>
<li>while GC (minor/major) will caused automatically only when `Java Heap` is full&hellip;
</li>
<li>Then: How about allocate 2G direct buffer while keep the Java Heap free?
       How is the direct buffer be `GC`ed?
<ul>
<li>Since the Java Heap is free, no GC is performed automatically
</li>
<li>Actually, when allocateDirect(), Java will `try {} catch {}` the
         OutOfMemoryError and force a major GC using `System.gc()`, and gc may
         free some byte buffer.
</li>
<li>But, if `-XX:+DisableExplicitGC` is specified&hellip;, good luck :(
</li>
</ul>

</li>
</ul>

</li>
</ul>




<pre class="example">public static void main(String[] args) {
    ByteBuffer bf=ByteBuffer.allocateDirect(300*1024*1024);
    bf=ByteBuffer.allocateDirect(300*1024*1024);
    bf=ByteBuffer.allocateDirect(300*1024*1024);
}
</pre>

<p>
     when run the sample code above w/ or w/o `-XX:+DisableExplicitGC`:
</p>


<pre class="example">~@mbjswglx56&gt; java -XX:+DisableExplicitGC -verbose:gc TestByteBuffer
Exception in thread "main" java.lang.OutOfMemoryError: Direct buffer memory
   at java.nio.Bits.reserveMemory(Bits.java:633)
   at java.nio.DirectByteBuffer.&lt;init&gt;(DirectByteBuffer.java:98)
   at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:288)
   at TestByteBuffer.main(TestByteBuffer.java:7)
</pre>


<pre class="example">~@mbjswglx56&gt; java -verbose:gc TestByteBuffer
[GC 313K-&gt;320K(59840K), 0.0007220 secs]
[Full GC 320K-&gt;121K(59840K), 0.0072890 secs]
</pre>

<ul>
<li>Socket Buffer
</li>
<li>JNI
</li>
<li>Native Heap and Stack
</li>
</ul>

</div>

</div>

<div id="outline-container-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Concurrent</h3>
<div class="outline-text-3" id="text-1-7">

<p>   see also <a href="#sec-1-17-1">Immutable Collection</a>
   see also <a href="#CopyOnWriteArrayList">CopyOnWriteArrayList</a>
</p>
</div>

<div id="outline-container-1-7-1" class="outline-4">
<h4 id="sec-1-7-1"><span class="section-number-4">1.7.1</span> AbstractQueuedSynchronizer</h4>
<div class="outline-text-4" id="text-1-7-1">

</div>

</div>

<div id="outline-container-1-7-2" class="outline-4">
<h4 id="sec-1-7-2"><span class="section-number-4">1.7.2</span> LockSupport</h4>
<div class="outline-text-4" id="text-1-7-2">

</div>

</div>

<div id="outline-container-1-7-3" class="outline-4">
<h4 id="sec-1-7-3"><span class="section-number-4">1.7.3</span> Callable vs. Runnable</h4>
<div class="outline-text-4" id="text-1-7-3">

</div>

</div>

<div id="outline-container-1-7-4" class="outline-4">
<h4 id="sec-1-7-4"><span class="section-number-4">1.7.4</span> CANCELED Future &amp; FutureTask</h4>
<div class="outline-text-4" id="text-1-7-4">

<ul>
<li>State "CANCELED"   from "DOING" <span class="timestamp-wrapper"> <span class="timestamp">2011-07-18 Mon 17:43</span></span>
</li>
</ul>

<p>    see also <a href="#sec-1-7-3">Callable vs. Runnable</a>
</p></div>

</div>

<div id="outline-container-1-7-5" class="outline-4">
<h4 id="sec-1-7-5"><span class="section-number-4">1.7.5</span> CountDownLatch</h4>
<div class="outline-text-4" id="text-1-7-5">

</div>

</div>

<div id="outline-container-1-7-6" class="outline-4">
<h4 id="sec-1-7-6"><span class="section-number-4">1.7.6</span> ReentrantLock</h4>
<div class="outline-text-4" id="text-1-7-6">

</div>

</div>

<div id="outline-container-1-7-7" class="outline-4">
<h4 id="sec-1-7-7"><span class="section-number-4">1.7.7</span> Semaphore</h4>
<div class="outline-text-4" id="text-1-7-7">

</div>

</div>

<div id="outline-container-1-7-8" class="outline-4">
<h4 id="sec-1-7-8"><span class="section-number-4">1.7.8</span> CyclicBarrier</h4>
<div class="outline-text-4" id="text-1-7-8">

</div>

</div>

<div id="outline-container-1-7-9" class="outline-4">
<h4 id="sec-1-7-9"><span class="section-number-4">1.7.9</span> Exchanger</h4>
<div class="outline-text-4" id="text-1-7-9">

</div>

</div>

<div id="outline-container-1-7-10" class="outline-4">
<h4 id="sec-1-7-10"><span class="section-number-4">1.7.10</span> Executor</h4>
<div class="outline-text-4" id="text-1-7-10">

</div>
</div>

</div>

<div id="outline-container-1-8" class="outline-3">
<h3 id="sec-1-8"><span class="section-number-3">1.8</span> HttpClient</h3>
<div class="outline-text-3" id="text-1-8">


</div>

<div id="outline-container-1-8-1" class="outline-4">
<h4 id="sec-1-8-1"><span class="section-number-4">1.8.1</span> cookie</h4>
<div class="outline-text-4" id="text-1-8-1">

</div>

</div>

<div id="outline-container-1-8-2" class="outline-4">
<h4 id="sec-1-8-2"><span class="section-number-4">1.8.2</span> connection pool</h4>
<div class="outline-text-4" id="text-1-8-2">

</div>
</div>

</div>

<div id="outline-container-1-9" class="outline-3">
<h3 id="sec-1-9"><span class="section-number-3">1.9</span> GC</h3>
<div class="outline-text-3" id="text-1-9">

<p>   see also <a href="#sec-1-3">Java Criticism</a>
</p>
</div>

<div id="outline-container-1-9-1" class="outline-4">
<h4 id="sec-1-9-1"><span class="section-number-4">1.9.1</span> Reference counting</h4>
<div class="outline-text-4" id="text-1-9-1">

</div>

</div>

<div id="outline-container-1-9-2" class="outline-4">
<h4 id="sec-1-9-2"><span class="section-number-4">1.9.2</span> Trace</h4>
<div class="outline-text-4" id="text-1-9-2">


</div>

<div id="outline-container-1-9-2-1" class="outline-5">
<h5 id="sec-1-9-2-1"><span class="section-number-5">1.9.2.1</span> Mark &amp; sweep GC</h5>
<div class="outline-text-5" id="text-1-9-2-1">

</div>

</div>

<div id="outline-container-1-9-2-2" class="outline-5">
<h5 id="sec-1-9-2-2"><span class="section-number-5">1.9.2.2</span> Stop and copy</h5>
<div class="outline-text-5" id="text-1-9-2-2">

</div>
</div>

</div>

<div id="outline-container-1-9-3" class="outline-4">
<h4 id="sec-1-9-3"><span class="section-number-4">1.9.3</span> GC root</h4>
<div class="outline-text-4" id="text-1-9-3">

</div>
</div>

</div>

<div id="outline-container-1-10" class="outline-3">
<h3 id="sec-1-10"><span class="section-number-3">1.10</span> CG (code generation / 代码生成 )</h3>
<div class="outline-text-3" id="text-1-10">

<p>   see also <a href="#CGLIB">CGLIB</a>
   see also <a href="#sec-1-24-1">ASM</a>
   see also <a href="#sec-1-14-5">Proxy</a>
</p></div>

</div>

<div id="outline-container-1-11" class="outline-3">
<h3 id="sec-1-11"><span class="section-number-3">1.11</span> GP</h3>
<div class="outline-text-3" id="text-1-11">

<p>see also <a href="#sec-1-3">Java Criticism</a>
google: “这可不是泛型”-Bruce Eckel眼中的Java泛型..
</p></div>

</div>

<div id="outline-container-1-12" class="outline-3">
<h3 id="sec-1-12"><span class="section-number-3">1.12</span> <span class="done DONE">DONE</span> JDK Dynamic Proxy &amp; CGLIB</h3>
<div class="outline-text-3" id="text-1-12">

<p>    <span class="timestamp-wrapper"><span class="timestamp-kwd">SCHEDULED: </span> <span class="timestamp">2011-08-30 Tue</span></span>  <span class="timestamp-wrapper"><span class="timestamp-kwd">CLOSED: </span> <span class="timestamp">2011-09-07 Wed 10:32</span></span><br/>
</p><ul>
<li>State "DONE"       from "DOING" <span class="timestamp-wrapper"> <span class="timestamp">2011-09-07 Wed 10:32</span></span>
</li>
</ul>

<p>   see also <a href="#sec-1-14-5">Proxy</a>
</p></div>

</div>

<div id="outline-container-1-13" class="outline-3">
<h3 id="sec-1-13"><span class="section-number-3">1.13</span> JNI</h3>
<div class="outline-text-3" id="text-1-13">


</div>

<div id="outline-container-1-13-1" class="outline-4">
<h4 id="sec-1-13-1"><span class="section-number-4">1.13.1</span> tools</h4>
<div class="outline-text-4" id="text-1-13-1">


</div>

<div id="outline-container-1-13-1-1" class="outline-5">
<h5 id="sec-1-13-1-1"><span class="section-number-5">1.13.1.1</span> javah</h5>
<div class="outline-text-5" id="text-1-13-1-1">

</div>

</div>

<div id="outline-container-1-13-1-2" class="outline-5">
<h5 id="sec-1-13-1-2"><span class="section-number-5">1.13.1.2</span> javap</h5>
<div class="outline-text-5" id="text-1-13-1-2">

</div>
</div>

</div>

<div id="outline-container-1-13-2" class="outline-4">
<h4 id="sec-1-13-2"><span class="section-number-4">1.13.2</span> Reference</h4>
<div class="outline-text-4" id="text-1-13-2">


</div>

<div id="outline-container-1-13-2-1" class="outline-5">
<h5 id="sec-1-13-2-1"><span class="section-number-5">1.13.2.1</span> GlobalRef</h5>
<div class="outline-text-5" id="text-1-13-2-1">

<ul>
<li id="sec-1-13-2-1-1">NewGlobalRef/DeleteGlobalRef<br/>
</li>
</ul>
</div>

</div>

<div id="outline-container-1-13-2-2" class="outline-5">
<h5 id="sec-1-13-2-2"><span class="section-number-5">1.13.2.2</span> LocalRef</h5>
<div class="outline-text-5" id="text-1-13-2-2">

<ul>
<li id="sec-1-13-2-2-1">DeleteLocalRef/NewLocalRef<br/>
</li>
</ul>
<ul>
<li id="sec-1-13-2-2-2">PopFrame/PushFrame<br/>
</li>
</ul>
</div>
</div>

</div>

<div id="outline-container-1-13-3" class="outline-4">
<h4 id="sec-1-13-3"><span class="section-number-4">1.13.3</span> JNIEnv</h4>
<div class="outline-text-4" id="text-1-13-3">


</div>

<div id="outline-container-1-13-3-1" class="outline-5">
<h5 id="sec-1-13-3-1"><span class="section-number-5">1.13.3.1</span> AttachThread</h5>
<div class="outline-text-5" id="text-1-13-3-1">

</div>
</div>

</div>

<div id="outline-container-1-13-4" class="outline-4">
<h4 id="sec-1-13-4"><span class="section-number-4">1.13.4</span> Monitor</h4>
<div class="outline-text-4" id="text-1-13-4">


</div>

<div id="outline-container-1-13-4-1" class="outline-5">
<h5 id="sec-1-13-4-1"><span class="section-number-5">1.13.4.1</span> MonitorEnter/MonitorExit</h5>
<div class="outline-text-5" id="text-1-13-4-1">

</div>
</div>
</div>

</div>

<div id="outline-container-1-14" class="outline-3">
<h3 id="sec-1-14"><span class="section-number-3">1.14</span> Reflection</h3>
<div class="outline-text-3" id="text-1-14">


</div>

<div id="outline-container-1-14-1" class="outline-4">
<h4 id="sec-1-14-1"><span class="section-number-4">1.14.1</span> Class</h4>
<div class="outline-text-4" id="text-1-14-1">


</div>

<div id="outline-container-1-14-1-1" class="outline-5">
<h5 id="sec-1-14-1-1"><span class="section-number-5">1.14.1.1</span> newInstance</h5>
<div class="outline-text-5" id="text-1-14-1-1">

</div>

</div>

<div id="outline-container-1-14-1-2" class="outline-5">
<h5 id="sec-1-14-1-2"><span class="section-number-5">1.14.1.2</span> forName</h5>
<div class="outline-text-5" id="text-1-14-1-2">

</div>

</div>

<div id="outline-container-1-14-1-3" class="outline-5">
<h5 id="sec-1-14-1-3"><span class="section-number-5">1.14.1.3</span> getConstructor, getDeclaredConstructor</h5>
<div class="outline-text-5" id="text-1-14-1-3">

</div>

</div>

<div id="outline-container-1-14-1-4" class="outline-5">
<h5 id="sec-1-14-1-4"><span class="section-number-5">1.14.1.4</span> getField, getDeclaredField</h5>
<div class="outline-text-5" id="text-1-14-1-4">

</div>

</div>

<div id="outline-container-1-14-1-5" class="outline-5">
<h5 id="sec-1-14-1-5"><span class="section-number-5">1.14.1.5</span> getMethod, getDeclaredMethod</h5>
<div class="outline-text-5" id="text-1-14-1-5">

</div>
</div>

</div>

<div id="outline-container-1-14-2" class="outline-4">
<h4 id="sec-1-14-2"><span class="section-number-4">1.14.2</span> Field</h4>
<div class="outline-text-4" id="text-1-14-2">


</div>

<div id="outline-container-1-14-2-1" class="outline-5">
<h5 id="sec-1-14-2-1"><span class="section-number-5">1.14.2.1</span> get</h5>
<div class="outline-text-5" id="text-1-14-2-1">

</div>

</div>

<div id="outline-container-1-14-2-2" class="outline-5">
<h5 id="sec-1-14-2-2"><span class="section-number-5">1.14.2.2</span> set</h5>
<div class="outline-text-5" id="text-1-14-2-2">

</div>

</div>

<div id="outline-container-1-14-2-3" class="outline-5">
<h5 id="sec-1-14-2-3"><span class="section-number-5">1.14.2.3</span> setAccessible</h5>
<div class="outline-text-5" id="text-1-14-2-3">

</div>
</div>

</div>

<div id="outline-container-1-14-3" class="outline-4">
<h4 id="sec-1-14-3"><span class="section-number-4">1.14.3</span> Method</h4>
<div class="outline-text-4" id="text-1-14-3">

</div>

</div>

<div id="outline-container-1-14-4" class="outline-4">
<h4 id="sec-1-14-4"><span class="section-number-4">1.14.4</span> Constructor</h4>
<div class="outline-text-4" id="text-1-14-4">


</div>

<div id="outline-container-1-14-4-1" class="outline-5">
<h5 id="sec-1-14-4-1"><span class="section-number-5">1.14.4.1</span> newInstance</h5>
<div class="outline-text-5" id="text-1-14-4-1">

</div>
</div>

</div>

<div id="outline-container-1-14-5" class="outline-4">
<h4 id="sec-1-14-5"><span class="section-number-4">1.14.5</span> Proxy</h4>
<div class="outline-text-4" id="text-1-14-5">

<p>see also <a href="#Dynamic-Proxy">Dynamic Proxy</a>
</p></div>
</div>

</div>

<div id="outline-container-1-15" class="outline-3">
<h3 id="sec-1-15"><span class="section-number-3">1.15</span> NIO</h3>
<div class="outline-text-3" id="text-1-15">


</div>

<div id="outline-container-1-15-1" class="outline-4">
<h4 id="sec-1-15-1"><span class="section-number-4">1.15.1</span> Buffer</h4>
<div class="outline-text-4" id="text-1-15-1">


</div>

<div id="outline-container-1-15-1-1" class="outline-5">
<h5 id="sec-1-15-1-1"><span class="section-number-5">1.15.1.1</span> ByteBuffer</h5>
<div class="outline-text-5" id="text-1-15-1-1">

</div>
</div>

</div>

<div id="outline-container-1-15-2" class="outline-4">
<h4 id="sec-1-15-2"><span class="section-number-4">1.15.2</span> <span class="done DONE">DONE</span> ImportVCardActivity use NIO?</h4>
<div class="outline-text-4" id="text-1-15-2">

<p> <span class="timestamp-wrapper"><span class="timestamp-kwd">CLOSED: </span> <span class="timestamp">2012-04-09 Mon 15:03</span></span>  <span class="timestamp-wrapper"><span class="timestamp-kwd">SCHEDULED: </span> <span class="timestamp">2012-04-09 周一</span></span><br/>
NIO, especially ByteBuffer.allocateDirect(), will improve performance in two
aspects:
</p><ol>
<li>allocateDirect use mmap to allocate buffer memory, thus bypass one
   kernel-user copy
</li>
<li>mmapped memory won't trigger GC
</li>
</ol>

</div>
</div>

</div>

<div id="outline-container-1-16" class="outline-3">
<h3 id="sec-1-16"><span class="section-number-3">1.16</span> Optimization</h3>
<div class="outline-text-3" id="text-1-16">

</div>

</div>

<div id="outline-container-1-17" class="outline-3">
<h3 id="sec-1-17"><span class="section-number-3">1.17</span> Java Collection Framework</h3>
<div class="outline-text-3" id="text-1-17">


</div>

<div id="outline-container-1-17-1" class="outline-4">
<h4 id="sec-1-17-1"><span class="section-number-4">1.17.1</span> <span class="done DONE">DONE</span> Immutable Collection</h4>
<div class="outline-text-4" id="text-1-17-1">

<p>     <span class="timestamp-wrapper"><span class="timestamp-kwd">SCHEDULED: </span> <span class="timestamp">2011-07-26 Tue</span></span>  <span class="timestamp-wrapper"><span class="timestamp-kwd">CLOSED: </span> <span class="timestamp">2011-07-27 Wed 15:27</span></span><br/>
</p><ul>
<li>State "DONE"       from "DOING" <span class="timestamp-wrapper"> <span class="timestamp">2011-07-27 Wed 15:27</span></span>
</li>
</ul>

<p>    see also <a href="#sec-1-3">Java Criticism</a>
    see also <a href="#sec-1-7">Concurrent</a>
    see also <a href="#CopyOnWriteArrayList">CopyOnWriteArrayList</a>
    see also <a href="#sec-1-17-2-2">Collections.unmodifiableXXX</a>
</p>
<p>
    google: why i hate java.util collection library
</p>
<p>
    SUN has inverted the Metabolite vs. Immutability in the class hierarchy.
    Immutability, in ANY language that wants to:
</p><ol>
<li>guarantee semantics,
</li>
<li>ease concurrency
</li>
<li>resource contention
</li>
</ol>

<p>    should have immutability as a default.
    However, SUN have decided to have Mutablity  as a default.
    e.g.
    `Collection unmodifiableList(Collection)` will return an immutabile collection, BUT, the unmodifiableList wrapper does nothing but wrap the
    `setXXX`, `addXXX`, `removeXXX` function to throw exception&hellip;
</p></div>

</div>

<div id="outline-container-1-17-2" class="outline-4">
<h4 id="sec-1-17-2"><span class="section-number-4">1.17.2</span> Collections</h4>
<div class="outline-text-4" id="text-1-17-2">


</div>

<div id="outline-container-1-17-2-1" class="outline-5">
<h5 id="sec-1-17-2-1"><span class="section-number-5">1.17.2.1</span> Collections.EMPTY<sub>LIST</sub> &amp; Collections.emptyList()</h5>
<div class="outline-text-5" id="text-1-17-2-1">

<p>     Sometimes we need to return an `empty` collections to indicate that no data available&hellip;what ever.
     Instead of return `new ArrayList(0)`, we can simply return Collections.EMPTY<sub>LIST</sub>, which is itself an <a href="#sec-1-17-1">Immutable Collection</a> and light-weighted
</p></div>

</div>

<div id="outline-container-1-17-2-2" class="outline-5">
<h5 id="sec-1-17-2-2"><span class="section-number-5">1.17.2.2</span> Collections.unmodifiableXXX</h5>
<div class="outline-text-5" id="text-1-17-2-2">

<p>     see also <a href="#Immutable-Collections">Immutable Collections</a>
</p></div>

</div>

<div id="outline-container-1-17-2-3" class="outline-5">
<h5 id="sec-1-17-2-3"><span class="section-number-5">1.17.2.3</span> Collection.synchronizedXXX</h5>
<div class="outline-text-5" id="text-1-17-2-3">

</div>
</div>

</div>

<div id="outline-container-1-17-3" class="outline-4">
<h4 id="sec-1-17-3"><span class="section-number-4">1.17.3</span> CopyOnWriteArrayList / CopyOnWriteArraySet</h4>
<div class="outline-text-4" id="text-1-17-3">

<p>    see also <a href="#sec-1-17-1">Immutable Collection</a>
</p></div>
</div>

</div>

<div id="outline-container-1-18" class="outline-3">
<h3 id="sec-1-18"><span class="section-number-3">1.18</span> Serialization</h3>
<div class="outline-text-3" id="text-1-18">

</div>

</div>

<div id="outline-container-1-19" class="outline-3">
<h3 id="sec-1-19"><span class="section-number-3">1.19</span> <span class="done DONE">DONE</span> UncaughtExceptionHandler</h3>
<div class="outline-text-3" id="text-1-19">

<p>    <span class="timestamp-wrapper"><span class="timestamp-kwd">CLOSED: </span> <span class="timestamp">2011-07-25 Mon 13:37</span></span><br/>
</p><ul>
<li>State "DONE"       from "TODO" <span class="timestamp-wrapper"> <span class="timestamp">2011-07-25 Mon 13:37</span></span>
</li>
</ul>

<p>   see also <a href="#Java-Process-Creation">Java Process Creation</a>
   see also <a href="#Android-Process-Crash-and-Restart">Android Process Crash and Restart</a>
</p></div>

</div>

<div id="outline-container-1-20" class="outline-3">
<h3 id="sec-1-20"><span class="section-number-3">1.20</span> JDWP</h3>
<div class="outline-text-3" id="text-1-20">

</div>

</div>

<div id="outline-container-1-21" class="outline-3">
<h3 id="sec-1-21"><span class="section-number-3">1.21</span> Memory Model</h3>
<div class="outline-text-3" id="text-1-21">

<p>   Memory model mainly talks about two topics:
</p><ol>
<li>re-ordering  (bytecode related)
      compiler writer should care about re-ordering in java language level
      Note: re-ordering in java language level has nothing to do with `out-of-order` execution of the CPU.

</li>
<li>visibility   (cpu related)
      compiler writer should insert some memory barrier to instruct CPU to update it's cache.
</li>
</ol>


</div>

<div id="outline-container-1-21-1" class="outline-4">
<h4 id="sec-1-21-1"><span class="section-number-4">1.21.1</span> happen-before</h4>
<div class="outline-text-4" id="text-1-21-1">

<ul>
<li>happen-before is a partial relationship introduced to java memory model in JSR-133.
</li>
<li>In single-threaded execution, all java instructions follows the `as-if-serial` semantic (introduced in LS),
      there is no need to enforce the happen-before relationship.
</li>
<li>In multi-threaded execution, happen-before relationship is enforced to make sure that there is no race condition.
</li>
<li>`volatile`, `synchronization`, `Thread` will heavily affect the happen-before relationship;
</li>
<li>happen-before affect both the re-ordering and visibility.
</li>
</ul>

</div>

</div>

<div id="outline-container-double-checked" class="outline-4">
<h4 id="double-checked"><a name="sec-1-21-2" id="sec-1-21-2"></a><span class="section-number-4">1.21.2</span> <span class="done DONE">DONE</span> double-checked locking</h4>
<div class="outline-text-4" id="text-double-checked">

<p>     <span class="timestamp-wrapper"><span class="timestamp-kwd">CLOSED: </span> <span class="timestamp">2011-08-19 Fri 11:36</span></span><br/>
</p><ul>
<li>State "DONE"       from "" <span class="timestamp-wrapper"> <span class="timestamp">2011-08-19 Fri 11:36</span></span>
</li>
</ul>

<p>    see also <a href="#sec-1-21">Memory Model</a>
    google: double-checked locking is BROKEN
</p>
<p>
    Double-checked locking was broken, just before JSR-133
</p>


<pre class="example">class Foo {
  private volatile Helper helper = null;
  public Helper getHelper() {
    Helper result = helper;
    if (result == null) {
        synchronized(this) {
            result = helper;
            if (result == null)
                helper = result = new Helper();
        }
    }
    return result;
  }
}
</pre>


<p>
    <span class="timestamp-wrapper"><span class="timestamp-kwd">SCHEDULED: </span> <span class="timestamp">2011-08-08 Mon</span></span><br/>
</p></div>

</div>

<div id="outline-container-1-21-3" class="outline-4">
<h4 id="sec-1-21-3"><span class="section-number-4">1.21.3</span> JSR 133 FAQ</h4>
<div class="outline-text-4" id="text-1-21-3">

<p>    google: JSR 133 (Java Memory Model) FAQ
</p><ul>
<li>volatile
</li>
<li>final
</li>
<li>synchronization
</li>
</ul>

</div>
</div>

</div>

<div id="outline-container-1-22" class="outline-3">
<h3 id="sec-1-22"><span class="section-number-3">1.22</span> Java Module System</h3>
<div class="outline-text-3" id="text-1-22">

<p>   see also <a href="#sec-1-23">ClassLoader</a>
</p>
</div>

<div id="outline-container-1-22-1" class="outline-4">
<h4 id="sec-1-22-1"><span class="section-number-4">1.22.1</span> JSR-277: Java Module System</h4>
<div class="outline-text-4" id="text-1-22-1">

</div>

</div>

<div id="outline-container-1-22-2" class="outline-4">
<h4 id="sec-1-22-2"><span class="section-number-4">1.22.2</span> OSGi &amp; HotSwap</h4>
<div class="outline-text-4" id="text-1-22-2">

</div>
</div>

</div>

<div id="outline-container-1-23" class="outline-3">
<h3 id="sec-1-23"><span class="section-number-3">1.23</span> ClassLoader</h3>
<div class="outline-text-3" id="text-1-23">

<p>   see also <a href="#sec-1-22">Java Module System</a>
</p>
</div>

<div id="outline-container-1-23-1" class="outline-4">
<h4 id="sec-1-23-1"><span class="section-number-4">1.23.1</span> Thread.setContextClassLoader() / Thread.getContextClassLoader()</h4>
<div class="outline-text-4" id="text-1-23-1">

<p><a href="http://stackoverflow.com/questions/4330885/setcontextclassloader-implications">http://stackoverflow.com/questions/4330885/setcontextclassloader-implications</a>
a backdoor in the ClassLoader architecture, which broken up the `Parents Delegation Scheme`, mainly used by JNDI,JDBC,JAXP and OSGi
</p></div>

</div>

<div id="outline-container-1-23-2" class="outline-4">
<h4 id="sec-1-23-2"><span class="section-number-4">1.23.2</span> Class.getClassLoader()</h4>
<div class="outline-text-4" id="text-1-23-2">

<p>    This is the default ClassLoader for Class.forName()
</p></div>

</div>

<div id="outline-container-1-23-3" class="outline-4">
<h4 id="sec-1-23-3"><span class="section-number-4">1.23.3</span> ClassLoader.getSystemClassLoader()</h4>
<div class="outline-text-4" id="text-1-23-3">

</div>
</div>

</div>

<div id="outline-container-1-24" class="outline-3">
<h3 id="sec-1-24"><span class="section-number-3">1.24</span> CG (Code Generation)</h3>
<div class="outline-text-3" id="text-1-24">


</div>

<div id="outline-container-1-24-1" class="outline-4">
<h4 id="sec-1-24-1"><span class="section-number-4">1.24.1</span> ASM</h4>
<div class="outline-text-4" id="text-1-24-1">

<p>    see also <a href="#Visitor-Pattern">Visitor Pattern</a>
</p></div>
</div>

</div>

<div id="outline-container-1-25" class="outline-3">
<h3 id="sec-1-25"><span class="section-number-3">1.25</span> Security</h3>
<div class="outline-text-3" id="text-1-25">


</div>

<div id="outline-container-1-25-1" class="outline-4">
<h4 id="sec-1-25-1"><span class="section-number-4">1.25.1</span> ClassLoader</h4>
<div class="outline-text-4" id="text-1-25-1">

</div>

</div>

<div id="outline-container-1-25-2" class="outline-4">
<h4 id="sec-1-25-2"><span class="section-number-4">1.25.2</span> SecurityManager</h4>
<div class="outline-text-4" id="text-1-25-2">

</div>

</div>

<div id="outline-container-1-25-3" class="outline-4">
<h4 id="sec-1-25-3"><span class="section-number-4">1.25.3</span> Policy</h4>
<div class="outline-text-4" id="text-1-25-3">

</div>

</div>

<div id="outline-container-1-25-4" class="outline-4">
<h4 id="sec-1-25-4"><span class="section-number-4">1.25.4</span> How To Run Beanshell in Sandbox?</h4>
<div class="outline-text-4" id="text-1-25-4">

</div>

</div>

<div id="outline-container-1-25-5" class="outline-4">
<h4 id="sec-1-25-5"><span class="section-number-4">1.25.5</span> keystore</h4>
<div class="outline-text-4" id="text-1-25-5">

<p>keystore 中同时包含私钥及证书
</p>
</div>

<div id="outline-container-1-25-5-1" class="outline-5">
<h5 id="sec-1-25-5-1"><span class="section-number-5">1.25.5.1</span> Keystore Explorer</h5>
<div class="outline-text-5" id="text-1-25-5-1">

</div>
</div>

</div>

<div id="outline-container-1-25-6" class="outline-4">
<h4 id="sec-1-25-6"><span class="section-number-4">1.25.6</span> keytool &amp; jarsigner</h4>
<div class="outline-text-4" id="text-1-25-6">

<p>    see also <a href="#">数字签名</a> <a href="#">数字证书</a>
    <a href="http://download.oracle.com/javase/1.3/docs/tooldocs/win32/jarsigner.html">http://download.oracle.com/javase/1.3/docs/tooldocs/win32/jarsigner.html</a>
</p>
<p>
    jarsigner will add two additional files to the original jar to generate
    the signed jar:
</p><ol>
<li>xxx.sf
        xxx.sf will contains the HASH of every source file, e.g.
        XX1.java
        ADFASDFASDFASDFASDFASF
        XX2.java
        SAFASDFASDFASDFASDFASDFSAF
        &hellip;
</li>
<li>xxx.dsa
        xxx.dsa is encoded in two parts:
<ol>
<li>digital signature of the xxx.sf
</li>
<li>certificate used to verify the signature
</li>
</ol>

</li>
</ol>


</div>
</div>

</div>

<div id="outline-container-1-26" class="outline-3">
<h3 id="sec-1-26"><span class="section-number-3">1.26</span> JVM based programming language</h3>
<div class="outline-text-3" id="text-1-26">


</div>

<div id="outline-container-1-26-1" class="outline-4">
<h4 id="sec-1-26-1"><span class="section-number-4">1.26.1</span> Closure</h4>
<div class="outline-text-4" id="text-1-26-1">

<ul>
<li>lisp implementation based on JVM
</li>
</ul>

</div>

</div>

<div id="outline-container-1-26-2" class="outline-4">
<h4 id="sec-1-26-2"><span class="section-number-4">1.26.2</span> Scala</h4>
<div class="outline-text-4" id="text-1-26-2">

<ul>
<li>`actor pattern` based concurrent programming
</li>
</ul>

</div>

</div>

<div id="outline-container-1-26-3" class="outline-4">
<h4 id="sec-1-26-3"><span class="section-number-4">1.26.3</span> JRuby</h4>
<div class="outline-text-4" id="text-1-26-3">

</div>

</div>

<div id="outline-container-1-26-4" class="outline-4">
<h4 id="sec-1-26-4"><span class="section-number-4">1.26.4</span> Groovy</h4>
<div class="outline-text-4" id="text-1-26-4">

</div>
</div>
</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2013-05-17T12:23+0800</p>
<p class="author">Author: sunway</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.1 with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 23</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
